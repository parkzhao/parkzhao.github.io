<!DOCTYPE html>












  


<html class="theme-next muse use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">






















<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.7.0">

<link rel="stylesheet" href="/css/main.css?v=7.2.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=7.2.0">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=7.2.0">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=7.2.0">


  <link rel="mask-icon" href="/images/logo.svg?v=7.2.0" color="#222">







<script id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '7.2.0',
    sidebar: {"position":"left","display":"post","offset":12,"onmobile":false,"dimmer":false},
    back2top: true,
    back2top_sidebar: false,
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta name="description" content="Haibin">
<meta property="og:type" content="website">
<meta property="og:title" content="HaibinTalk">
<meta property="og:url" content="http://www.haibin.me/page/2/index.html">
<meta property="og:site_name" content="HaibinTalk">
<meta property="og:description" content="Haibin">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="HaibinTalk">
<meta name="twitter:description" content="Haibin">



  <link rel="alternate" href="/atom.xml" title="HaibinTalk" type="application/atom+xml">



  
  
  <link rel="canonical" href="http://www.haibin.me/page/2/">



<script id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>HaibinTalk</title>
  












  <noscript>
  <style>
  .use-motion .motion-element,
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-title { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope="" itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope="" itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">HaibinTalk</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
      
        <p class="site-subtitle">Focusing,Thinking,Doing</p>
      
    
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="Toggle navigation bar">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">

    
    
      
    

    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>Home</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-about">

    
    
      
    

    

    <a href="/about/" rel="section"><i class="menu-item-icon fa fa-fw fa-user"></i> <br>About</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-tags">

    
    
      
    

    

    <a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i> <br>Tags</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-categories">

    
    
      
    

    

    <a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i> <br>Categories</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">

    
    
      
    

    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>Archives</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-commonweal">

    
    
      
    

    

    <a href="/404.html" rel="section"><i class="menu-item-icon fa fa-fw fa-heartbeat"></i> <br>Commonweal 404</a>

  </li>

      
      
    </ul>
  

  
    

  

  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://www.haibin.me/2016/05/22/帕克胖折腾系列-建立可用的NFS存储/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="haibin">
      <meta itemprop="description" content="Haibin">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="HaibinTalk">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2016/05/22/帕克胖折腾系列-建立可用的NFS存储/" class="post-title-link" itemprop="url">帕克胖折腾系列(-)建立可用的NFS存储</a>
              
            
          </h1>
        

        <div class="post-meta">

          
          
          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2016-05-22 11:47:43" itemprop="dateCreated datePublished" datetime="2016-05-22T11:47:43+08:00">2016-05-22</time>
            </span>
          

          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2019-07-04 07:28:43" itemprop="dateModified" datetime="2019-07-04T07:28:43+08:00">2019-07-04</time>
              </span>
            
          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/Linux/" itemprop="url" rel="index"><span itemprop="name">Linux</span></a></span>

                
                
                  , 
                
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/Linux/NFS/" itemprop="url" rel="index"><span itemprop="name">NFS</span></a></span>

                
                
                  , 
                
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/Linux/NFS/存储/" itemprop="url" rel="index"><span itemprop="name">存储</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          <br>
          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="需求"><a href="#需求" class="headerlink" title="需求"></a>需求</h1><blockquote>
<p>生命不息，折腾不止!  </p>
</blockquote>
<p>建立可用的NFS共享存储<br><strong>建议通读一次后，再进行尝试！！</strong>  </p>
<h2 id="硬件"><a href="#硬件" class="headerlink" title="硬件"></a>硬件</h2><p>1). 三张千兆网卡<br>2). 两根千兆网线<br>拓扑图<br><img src="http://7xlvqo.com1.z0.glb.clouddn.com/6652b89d89446a3a949d6986fb269ac8.png" alt="网络拓扑图">  </p>
<h1 id="基础系统"><a href="#基础系统" class="headerlink" title="基础系统"></a>基础系统</h1><h2 id="分区，系统安装"><a href="#分区，系统安装" class="headerlink" title="分区，系统安装"></a>分区，系统安装</h2><p>两台机器，分别安装ubuntu操作系统<br>具体的分区信息如下:<br><figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">swap  <span class="number">4</span>G</span><br><span class="line">/boot <span class="number">1</span>G</span><br><span class="line">/        <span class="number">100</span>G 安装系统</span><br></pre></td></tr></table></figure></p>
<p>系统都通过卷管理<br><figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">pvcreate /dev/sda<span class="string">[3]</span></span><br><span class="line"></span><br><span class="line">pvcreate /dev/sdb<span class="string">[1]</span></span><br></pre></td></tr></table></figure></p>
<h2 id="安装必要软件"><a href="#安装必要软件" class="headerlink" title="安装必要软件"></a>安装必要软件</h2><figure class="highlight smali"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install python-software-properties</span><br><span class="line">sudo<span class="built_in"> add-apt-repository </span>ppa:icamargo/drbd</span><br><span class="line">sudo apt-get update</span><br><span class="line">sudo apt-get upgrade</span><br></pre></td></tr></table></figure>
<h2 id="配置固定IP"><a href="#配置固定IP" class="headerlink" title="配置固定IP"></a>配置固定IP</h2><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">##server01##</span></span><br><span class="line"><span class="comment"># The primary network interface</span></span><br><span class="line">auto eth1</span><br><span class="line">iface eth1 inet static</span><br><span class="line">       <span class="built_in"> address </span>192.168.1.100</span><br><span class="line">        netmask 255.255.255.0</span><br><span class="line"></span><br><span class="line"><span class="comment">##server02##</span></span><br><span class="line"><span class="comment"># The primary network interface</span></span><br><span class="line">auto eth1</span><br><span class="line">iface eth1 inet static</span><br><span class="line">       <span class="built_in"> address </span>192.168.1.100</span><br><span class="line">        netmask 255.255.255.0</span><br></pre></td></tr></table></figure>
<h2 id="配置host"><a href="#配置host" class="headerlink" title="配置host"></a>配置host</h2><figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sudo vi /etc/hosts</span><br><span class="line"></span><br><span class="line">######</span><br><span class="line"><span class="number">192.168</span><span class="number">.1</span><span class="number">.100</span>   server01</span><br><span class="line"><span class="number">192.168</span><span class="number">.1</span><span class="number">.101</span>   server02</span><br></pre></td></tr></table></figure>
<h2 id="同步服务器时间"><a href="#同步服务器时间" class="headerlink" title="同步服务器时间"></a>同步服务器时间</h2><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-<span class="built_in">get</span> install ntp</span><br><span class="line">//同步时间任务</span><br><span class="line">sudo crontab -e</span><br><span class="line"><span class="comment">##Added the following line to the end.</span></span><br><span class="line"><span class="number">1</span> * * * * root ntpdate au.pool.ntp.org</span><br></pre></td></tr></table></figure>
<h2 id="内核调试"><a href="#内核调试" class="headerlink" title="内核调试"></a>内核调试</h2><figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">##Both##</span><br><span class="line"></span><br><span class="line">sudo vi /etc/sysctl.conf.</span><br><span class="line"></span><br><span class="line"># drbd tuning</span><br><span class="line">net.ipv4.tcp_no_metrics_save = <span class="number">1</span></span><br><span class="line">net.core.rmem_max = <span class="number">33554432</span></span><br><span class="line">net.core.wmem_max = <span class="number">33554432</span></span><br><span class="line">net.ipv4.tcp_rmem = <span class="number">4096</span> <span class="number">87380</span> <span class="number">33554432</span></span><br><span class="line">net.ipv4.tcp_wmem = <span class="number">4096</span> <span class="number">87380</span> <span class="number">33554432</span></span><br><span class="line">vm.dirty_ratio = <span class="number">10</span></span><br><span class="line">vm.dirty_background_ratio = <span class="number">4</span></span><br></pre></td></tr></table></figure>
<h1 id="DRBD"><a href="#DRBD" class="headerlink" title="DRBD"></a>DRBD</h1><h2 id="DRBD安装"><a href="#DRBD安装" class="headerlink" title="DRBD安装"></a>DRBD安装</h2><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">##Both</span></span><br><span class="line">sudo apt-<span class="builtin-name">get</span> install drbd8-utils heartbeat</span><br></pre></td></tr></table></figure>
<h2 id="文件配置"><a href="#文件配置" class="headerlink" title="文件配置"></a>文件配置</h2><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">##Both</span></span><br><span class="line">sudo vi /etc/drbd.d/disk1.res</span><br><span class="line">resource disk1 &#123;</span><br><span class="line"></span><br><span class="line">        protocol C;</span><br><span class="line"></span><br><span class="line">        handlers &#123;</span><br><span class="line">                pri-on-incon-degr <span class="string">"echo o &gt; /proc/sysrq-trigger ; halt -f"</span>;</span><br><span class="line">                pri-lost-after-sb <span class="string">"echo o &gt; /proc/sysrq-trigger ; halt -f"</span>;</span><br><span class="line">                local-io-<span class="builtin-name">error</span> <span class="string">"echo o &gt; /proc/sysrq-trigger ; halt -f"</span>;</span><br><span class="line">                outdate-peer <span class="string">"/usr/lib/heartbeat/drbd-peer-outdater -t 5"</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        startup &#123;</span><br><span class="line">                degr-wfc-timeout 120;</span><br><span class="line">                wfc-timeout 30;</span><br><span class="line">                outdated-wfc-timeout 20;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        disk &#123;</span><br><span class="line">                on-io-<span class="builtin-name">error</span> detach;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        net &#123;</span><br><span class="line">                cram-hmac-alg sha1;</span><br><span class="line">                shared-secret <span class="string">"password"</span>;</span><br><span class="line">                after-sb-0pri disconnect;</span><br><span class="line">                after-sb-1pri disconnect;</span><br><span class="line">                after-sb-2pri disconnect;</span><br><span class="line">                rr-conflict disconnect;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        syncer &#123;</span><br><span class="line">                rate 100M;</span><br><span class="line">                verify-alg sha1;</span><br><span class="line">                al-extents 257;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        on server01 &#123;</span><br><span class="line">                device  /dev/drbd0;</span><br><span class="line">                disk    /dev/sdb1;</span><br><span class="line">               <span class="built_in"> address </span>192.168.0.211:7788;</span><br><span class="line">                meta-disk internal;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        on server02&#123;</span><br><span class="line">                device  /dev/drbd0;</span><br><span class="line">                disk    /dev/sdb1;</span><br><span class="line">               <span class="built_in"> address </span>192.168.0.212:7788;</span><br><span class="line">                meta-disk internal;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="更改DRDB权限"><a href="#更改DRDB权限" class="headerlink" title="更改DRDB权限"></a>更改DRDB权限</h2><figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">##Both</span></span><br><span class="line"></span><br><span class="line">sudo chgrp haclient /<span class="class"><span class="keyword">lib</span>/<span class="title">drbd</span>/<span class="title">drbdsetup</span>-84</span></span><br><span class="line">sudo chmod o-x /<span class="class"><span class="keyword">lib</span>/<span class="title">drbd</span>/<span class="title">drbdsetup</span>-84</span></span><br><span class="line">sudo chmod u+s /<span class="class"><span class="keyword">lib</span>/<span class="title">drbd</span>/<span class="title">drbdsetup</span>-84</span></span><br><span class="line">sudo chgrp haclient /sbin/drbdmeta</span><br><span class="line">sudo chmod o-x /sbin/drbdmeta</span><br><span class="line">sudo chmod u+s /sbin/drbdmeta</span><br></pre></td></tr></table></figure>
<h2 id="创建资源"><a href="#创建资源" class="headerlink" title="创建资源"></a>创建资源</h2><figure class="highlight dsconfig"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">##Both</span></span><br><span class="line"><span class="string">drbdadm </span><span class="built_in">create-md</span> <span class="string">disk1</span></span><br></pre></td></tr></table></figure>
<h2 id="启动DRBD"><a href="#启动DRBD" class="headerlink" title="启动DRBD"></a>启动DRBD</h2><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">##Both</span></span><br><span class="line">sudo<span class="built_in"> service </span>drbd start</span><br></pre></td></tr></table></figure>
<h2 id="初始化同步"><a href="#初始化同步" class="headerlink" title="初始化同步"></a>初始化同步</h2><p>server01作为master,并且开始初始化同步<br><figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">##server01</span><br><span class="line">drbdadm -- --overwrite-data-<span class="keyword">of</span>-peer primary disk1</span><br></pre></td></tr></table></figure></p>
<p>监视同步过程<br><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">watch</span> <span class="string">cat</span> <span class="string">/proc/drbd</span></span><br><span class="line"><span class="comment">###</span></span><br><span class="line"><span class="string">Every</span> <span class="number">2.0</span><span class="attr">s:</span> <span class="string">cat</span> <span class="string">/proc/drbd</span>                                                  <span class="string">Sun</span> <span class="string">Jun</span>  <span class="number">8</span> <span class="number">08</span><span class="string">:00:49</span> <span class="number">2014</span></span><br><span class="line"></span><br><span class="line"><span class="attr">version:</span> <span class="number">8.4</span><span class="number">.3</span> <span class="string">(api:1/proto:86-101)</span></span><br><span class="line"><span class="attr">srcversion:</span> <span class="string">F97798065516C94BE0F27DC</span></span><br><span class="line"><span class="number">0</span><span class="string">:</span> <span class="attr">cs:SyncTarget</span> <span class="attr">ro:Secondary/Secondary</span> <span class="attr">ds:Inconsistent/UpToDate</span> <span class="string">C</span> <span class="string">r-----</span></span><br><span class="line">    <span class="attr">ns:0</span> <span class="attr">nr:90397696</span> <span class="attr">dw:90389504</span> <span class="attr">dr:0</span> <span class="attr">al:0</span> <span class="attr">bm:5516</span> <span class="attr">lo:9</span> <span class="attr">pe:6</span> <span class="attr">ua:8</span> <span class="attr">ap:0</span> <span class="attr">ep:1</span> <span class="attr">wo:f</span> <span class="attr">oos:1842345780</span></span><br><span class="line">        <span class="string">[&gt;....................]</span> <span class="string">sync'ed:</span>  <span class="number">4.7</span><span class="string">%</span> <span class="string">(1799164/1887436)Mfinish:</span> <span class="number">14</span><span class="string">:11:31</span> <span class="attr">speed:</span> <span class="number">36</span><span class="string">,044</span> <span class="string">(36,</span></span><br><span class="line"><span class="number">168</span><span class="string">)</span> <span class="attr">want:</span> <span class="number">3</span><span class="string">,280</span> <span class="string">K/sec</span></span><br></pre></td></tr></table></figure></p>
<h2 id="测试同步"><a href="#测试同步" class="headerlink" title="测试同步"></a>测试同步</h2><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">##server01</span><br><span class="line"></span><br><span class="line">sudo mkfs<span class="selector-class">.ext4</span> /dev/drbd0</span><br><span class="line">sudo mkdir -<span class="selector-tag">p</span> /srv/data</span><br><span class="line">sudo mount /dev/drbd0 /srv/data</span><br></pre></td></tr></table></figure>
<p>创建磁盘块<br><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">dd <span class="attribute">if</span>=/dev/zero <span class="attribute">of</span>=/srv/data/test.zeros <span class="attribute">bs</span>=1M <span class="attribute">count</span>=1000</span><br><span class="line"></span><br><span class="line"><span class="comment">##server01</span></span><br><span class="line">sudo umount /srv/data</span><br><span class="line">drbdadm secondary disk1</span><br></pre></td></tr></table></figure></p>
<p>查看同步过程<br><figure class="highlight haskell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">##server02</span></span><br><span class="line"><span class="title">sudo</span> mkdir -p /srv/<span class="class"><span class="keyword">data</span></span></span><br><span class="line"><span class="title">sudo</span> drbdadm primary disk1</span><br><span class="line"><span class="title">sudo</span> mount /dev/drbd0 /srv/<span class="class"><span class="keyword">data</span></span></span><br><span class="line"></span><br><span class="line"><span class="title">sudo</span> ls /srv/<span class="class"><span class="keyword">data</span></span></span><br><span class="line"><span class="meta">##Check for test.zeros file</span></span><br><span class="line"></span><br><span class="line"><span class="title">sudo</span> rm /srv/<span class="class"><span class="keyword">data</span>/test.zeros</span></span><br><span class="line"><span class="title">sudo</span> umount /srv/<span class="class"><span class="keyword">data</span></span></span><br><span class="line"><span class="title">sudo</span> drbdadm secondary disk1</span><br><span class="line"></span><br><span class="line"><span class="meta">##server01</span></span><br><span class="line"><span class="title">sudo</span> drbdadm primary disk1</span><br><span class="line"><span class="title">sudo</span> mount /dev/drbd0 /srv/<span class="class"><span class="keyword">data</span></span></span><br><span class="line"></span><br><span class="line"><span class="title">sudo</span> ls /srv/<span class="class"><span class="keyword">data</span></span></span><br><span class="line"><span class="meta">##Check that the test.zeros file is no longer there</span></span><br></pre></td></tr></table></figure></p>
<p>取消自启动<br><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo update-rc<span class="selector-class">.d</span> -f drbd remove</span><br></pre></td></tr></table></figure></p>
<h1 id="NFS"><a href="#NFS" class="headerlink" title="NFS"></a>NFS</h1><h2 id="安装nfs-kernel-server"><a href="#安装nfs-kernel-server" class="headerlink" title="安装nfs kernel server"></a>安装nfs kernel server</h2><figure class="highlight axapta"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">##Both</span></span><br><span class="line">sudo apt-get install nfs-kernel-<span class="keyword">server</span> nfs-<span class="keyword">common</span></span><br></pre></td></tr></table></figure>
<h2 id="取消自启动"><a href="#取消自启动" class="headerlink" title="取消自启动"></a>取消自启动</h2><figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">##Both</span><br><span class="line">sudo update-rc.d -f nfs-kernel-server remove</span><br><span class="line"># sudo update-rc.d -f nfs-common remove</span><br><span class="line">sudo update-rc.d nfs-kernel-server stop <span class="number">20</span> <span class="number">0</span> <span class="number">1</span> <span class="number">2</span> <span class="number">3</span> <span class="number">4</span> <span class="number">5</span> <span class="number">6</span> .</span><br><span class="line"># sudo update-rc.d nfs-common  stop <span class="number">20</span> <span class="number">0</span> <span class="number">1</span> <span class="number">2</span> <span class="number">3</span> <span class="number">4</span> <span class="number">5</span> <span class="number">6</span> .</span><br></pre></td></tr></table></figure>
<h2 id="配置NFS到DRBD设备"><a href="#配置NFS到DRBD设备" class="headerlink" title="配置NFS到DRBD设备"></a>配置NFS到DRBD设备</h2><figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">##server01</span></span><br><span class="line">sudo mount /dev/drbd0 /srv/data</span><br><span class="line">sudo mv /var/<span class="class"><span class="keyword">lib</span>/<span class="title">nfs</span>/ /<span class="title">srv</span>/<span class="title">data</span>/</span></span><br><span class="line">sudo ln -s /srv/data/nfs/ <span class="regexp">/var/lib</span><span class="regexp">/nfs</span></span><br><span class="line"><span class="regexp">sudo mv /etc</span><span class="regexp">/exports /srv</span><span class="regexp">/data</span></span><br><span class="line"><span class="regexp">sudo ln -s /srv</span><span class="regexp">/data/exports</span> /etc/exports</span><br><span class="line"></span><br><span class="line"><span class="comment">##server02</span></span><br><span class="line">sudo rm -rf /var/<span class="class"><span class="keyword">lib</span>/<span class="title">nfs</span></span></span><br><span class="line">sudo ln -s /srv/data/nfs/ <span class="regexp">/var/lib</span><span class="regexp">/nfs</span></span><br><span class="line"><span class="regexp">sudo rm /etc</span><span class="regexp">/exports</span></span><br><span class="line"><span class="regexp">sudo ln -s /srv</span><span class="regexp">/data/exports</span> /etc/exports</span><br></pre></td></tr></table></figure>
<h2 id="共享配置"><a href="#共享配置" class="headerlink" title="共享配置"></a>共享配置</h2><figure class="highlight haskell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">##server01</span></span><br><span class="line"><span class="title">sudo</span> mkdir /srv/<span class="class"><span class="keyword">data</span>/sharet</span></span><br><span class="line"><span class="title">sudo</span> chmod <span class="number">777</span> /srv/<span class="class"><span class="keyword">data</span>/share</span></span><br><span class="line"><span class="title">sudo</span> vi /etc/exports</span><br><span class="line"></span><br><span class="line"><span class="meta">##Add to the bottom</span></span><br><span class="line"><span class="title">sudo</span> vi /etc/exports</span><br><span class="line">/srv/<span class="class"><span class="keyword">data</span>/share        192.168.0.*(<span class="title">rw</span>,<span class="title">no_subtree_check</span>,<span class="title">no_all_squash</span>,<span class="title">no_root_squash</span>)</span></span><br></pre></td></tr></table></figure>
<p>配置完成后卸载掉/dev/drbd0<br><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo umount <span class="regexp">/dev/</span>drbd0</span><br></pre></td></tr></table></figure></p>
<h1 id="Corosync"><a href="#Corosync" class="headerlink" title="Corosync"></a>Corosync</h1><p>corosync 是用于处理心跳和上报节点信息的软件  </p>
<h2 id="安装配置Corosync"><a href="#安装配置Corosync" class="headerlink" title="安装配置Corosync"></a>安装配置Corosync</h2><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">server01<span class="variable">@server01</span><span class="symbol">:~</span><span class="comment"># apt-get install -y corosync</span></span><br><span class="line">server02<span class="variable">@server02</span><span class="symbol">:~</span><span class="comment"># apt-get install -y corosync</span></span><br></pre></td></tr></table></figure>
<p>安装完成以后修改配置文件 /etc/corosync/corosync.conf 找到<br><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">interface</span> <span class="string">&#123;</span></span><br><span class="line">     <span class="comment"># The following values need to be set based on your environment</span></span><br><span class="line">     <span class="attr">ringnumber:</span> <span class="number">0</span></span><br><span class="line">     <span class="attr">bindnetaddr:</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span></span><br><span class="line">     <span class="attr">mcastaddr:</span> <span class="number">226.94</span><span class="number">.1</span><span class="number">.1</span></span><br><span class="line">     <span class="attr">mcastport:</span> <span class="number">5405</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure></p>
<p>其中的 bindnetaddr 需要根据当前网络修改, 通过命令 (其中 eth1 根据实际的网络修改)<br><code>ip addr | grep &quot;inet &quot; | grep eth1 | awk &#39;{print $4}&#39; | sed s/255/0/</code><br>可以看到这里我们需要修成的值是 192.168.1.0. 于是我们把这段配置修改成<br><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">interface</span> <span class="string">&#123;</span></span><br><span class="line">        <span class="comment"># The following values need to be set based on your environment</span></span><br><span class="line">        <span class="attr">ringnumber:</span> <span class="number">0</span></span><br><span class="line">        <span class="attr">bindnetaddr:</span> <span class="number">192.168</span><span class="number">.1</span><span class="number">.0</span></span><br><span class="line">        <span class="attr">mcastaddr:</span> <span class="number">226.94</span><span class="number">.1</span><span class="number">.1</span></span><br><span class="line">        <span class="attr">mcastport:</span> <span class="number">5405</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure></p>
<p>接着找到<br><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">server02@server02:~$ sudo cat /etc/corosync/service.d/pcmk</span><br><span class="line">service &#123;</span><br><span class="line">        # Load the Pacemaker Cluster<span class="built_in"> Resource </span>Manager</span><br><span class="line">        ver:       0</span><br><span class="line">        name:      pacemaker</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>把其中的 ver: 0 修改成 1 也就是修改成:<br><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">service &#123;</span><br><span class="line">        # Load the Pacemaker Cluster<span class="built_in"> Resource </span>Manager</span><br><span class="line">        ver:      1</span><br><span class="line">        name:      pacemaker</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="启动Corosync"><a href="#启动Corosync" class="headerlink" title="启动Corosync"></a>启动Corosync</h2><p>完成以上配置后还需要修改 /etc/default/corosync 将<br><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">START=no</span><br><span class="line"></span><br><span class="line">修改成</span><br><span class="line"></span><br><span class="line">START=yes</span><br></pre></td></tr></table></figure></p>
<p>接着通过命令, 启动 corosync<br><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">server01@server01:~# sudo<span class="built_in"> service </span>corosync start</span><br><span class="line">server02@server02:~# sudo<span class="built_in"> service </span>corosync start</span><br></pre></td></tr></table></figure></p>
<h1 id="Pacemaker"><a href="#Pacemaker" class="headerlink" title="Pacemaker"></a>Pacemaker</h1><p>pacemaker 是一个群集资源管理器, 用于管理 corosync 的节点.  </p>
<h2 id="安装和运行-pacemaker"><a href="#安装和运行-pacemaker" class="headerlink" title="安装和运行 pacemaker"></a>安装和运行 pacemaker</h2><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">server01@server01:~#sudo apt-<span class="builtin-name">get</span> install -y pacemaker</span><br><span class="line"></span><br><span class="line">server02@server02:~#sudo apt-<span class="builtin-name">get</span> install -y pacemaker</span><br><span class="line"></span><br><span class="line">server01@server01:~#sudo<span class="built_in"> service </span>pacemaker start</span><br><span class="line"></span><br><span class="line">server02@server02:~#sudo<span class="built_in"> service </span>pacemaker start</span><br></pre></td></tr></table></figure>
<p>完成后就可以通过命令 crm status 查看节点状态了.<br><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">server01@server01:~#sudo  crm status</span><br><span class="line"></span><br><span class="line">============</span><br><span class="line">Last updated: Mon Dec  2 16:45:30 2013</span><br><span class="line">Last change: Mon Dec  2 16:41:35 2013 via crmd on db2</span><br><span class="line">Stack: openais</span><br><span class="line">Current DC: NONE</span><br><span class="line">2 Nodes configured, 2 expected votes</span><br><span class="line">0 Resources configured.</span><br><span class="line">============</span><br><span class="line"></span><br><span class="line">Node db1: UNCLEAN (offline)</span><br><span class="line">Node db2: UNCLEAN (offline)</span><br></pre></td></tr></table></figure></p>
<p>可以看到目前的2个节点 server01和 server02都是离线的. 接着就需要配置 pacemaker 了  </p>
<h2 id="配置-pacemaker"><a href="#配置-pacemaker" class="headerlink" title="配置 pacemaker"></a>配置 pacemaker</h2><p>首先在 server01输入<br><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo crm configure <span class="keyword">property</span><span class="title"> </span><span class="attr">stonith-enabled=</span><span class="literal">false</span></span><br><span class="line">sudo  crm configure <span class="keyword">property</span><span class="title"> </span><span class="attr">no-quorum-policy=</span>ignore</span><br><span class="line"></span><br><span class="line">sudo  crm configure <span class="keyword">rsc_defaults</span><span class="title"> </span><span class="attr">resource-stickiness=</span><span class="number">100</span></span><br></pre></td></tr></table></figure></p>
<p>这几条命令保证, 当 db1 宕机切换到 db2 后, db1 修复好重新上线也不会自动的把主机转移回 db1, 造成不必要的切换.  </p>
<h2 id="配置-drbd"><a href="#配置-drbd" class="headerlink" title="配置 drbd"></a>配置 drbd</h2><p>继续再终端输入 crm configure 进入配置模式, 接着输入<br><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">sudo crm configure</span><br><span class="line"><span class="keyword">primitive</span><span class="title"> drbd0</span> ocf:linbit:drbd \</span><br><span class="line">    <span class="keyword">params</span> <span class="attr">drbd_resource=</span><span class="string">"disk1"</span> \</span><br><span class="line">    <span class="keyword">op</span> <span class="literal">monitor</span> <span class="attr">interval=</span><span class="string">"29s"</span> <span class="attr">role=</span><span class="string">"Master"</span> \</span><br><span class="line">    <span class="keyword">op</span> <span class="literal">monitor</span> <span class="attr">interval=</span><span class="string">"31s"</span> <span class="attr">role=</span><span class="string">"Slave"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">ms</span> <span class="title">ms-drbd0</span> drbd0 \</span><br><span class="line">    <span class="keyword">meta</span> <span class="attr">master-max=</span><span class="string">"1"</span> <span class="attr">master-node-max=</span><span class="string">"1"</span> \</span><br><span class="line">        <span class="attr">clone-max=</span><span class="string">"2"</span> <span class="attr">clone-node-max=</span><span class="string">"1"</span> \</span><br><span class="line">        <span class="attr">notify=</span><span class="string">"true"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">primitive</span><span class="title"> db-fs</span> ocf:heartbeat:Filesystem \</span><br><span class="line">    <span class="keyword">params</span> <span class="attr">fstype=</span>ext4 <span class="attr">directory=</span>/srv/data \</span><br><span class="line">        <span class="attr">device=</span>/dev/drbd0</span><br><span class="line"></span><br><span class="line"><span class="keyword">group</span> <span class="title">db-ha-group</span> db-fs</span><br><span class="line"></span><br><span class="line"><span class="keyword">colocation</span> <span class="title">db-ha-group-on-ms-drbd0</span> <span class="literal">inf</span>: db-ha-<span class="keyword">group</span> <span class="title">ms-drbd0</span>:<span class="literal">Master</span></span><br><span class="line"><span class="keyword">order</span> <span class="title">db-ha-group-after-ms-drbd0</span> <span class="literal">inf</span>: ms-drbd0:<span class="literal">promote</span> db-ha-group:<span class="literal">start</span></span><br><span class="line"></span><br><span class="line">commit</span><br><span class="line">exit</span><br></pre></td></tr></table></figure></p>
<p>这时可以通过 crm status 查看到<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">Online</span>: [ db1 db2 ]</span><br><span class="line"></span><br><span class="line">Master/Slave Set: ms-drbd0 [drbd0]</span><br><span class="line">    <span class="attribute">Masters</span>: [ db1 ]</span><br><span class="line">    <span class="attribute">Slaves</span>: [ db2 ]</span><br><span class="line">Resource Group: db-ha-group</span><br><span class="line">    db-fs      (ocf::heartbeat:Filesystem):    Started db1</span><br></pre></td></tr></table></figure></p>
<p>当前的 drbd 已经在 server01 上启动并挂载到 /srv/data 下了.  </p>
<h2 id="配置-vip"><a href="#配置-vip" class="headerlink" title="配置 vip"></a>配置 vip</h2><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo crm configure primitive db-ip ocf:heartbeat:IPaddr2 \</span><br><span class="line">    params <span class="attribute">ip</span>=<span class="string">"192.168.0.250"</span> <span class="attribute">nic</span>=<span class="string">"eth0"</span> meta <span class="attribute">target-role</span>=stopped</span><br><span class="line">echo $(crm configure show db-ha-group) db-ip | crm configure load update -</span><br><span class="line">crm<span class="built_in"> resource </span>start db-ip</span><br></pre></td></tr></table></figure>
<p>以上命令就是新建了一个叫 db-ip 的资源, 并把他加入 db-ha-group 组并启动. 为了验证是否成功我们可以输入<br><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">server01</span>@<span class="selector-tag">server01</span>:~<span class="selector-id">#sudo</span>  <span class="selector-tag">crm</span> <span class="selector-tag">status</span></span><br><span class="line"></span><br><span class="line"><span class="selector-tag">Online</span>: <span class="selector-attr">[ db1 db2 ]</span></span><br><span class="line"></span><br><span class="line"><span class="selector-tag">Master</span>/<span class="selector-tag">Slave</span> <span class="selector-tag">Set</span>: <span class="selector-tag">ms-drbd0</span> <span class="selector-attr">[drbd0]</span></span><br><span class="line">    <span class="selector-tag">Masters</span>: <span class="selector-attr">[ db1 ]</span></span><br><span class="line">    <span class="selector-tag">Slaves</span>: <span class="selector-attr">[ db2 ]</span></span><br><span class="line"><span class="selector-tag">Resource</span> <span class="selector-tag">Group</span>: <span class="selector-tag">db-ha-group</span></span><br><span class="line">    <span class="selector-tag">db-fs</span>      (<span class="attribute">ocf</span>::<span class="attribute">heartbeat</span>:Filesystem):    <span class="selector-tag">Started</span> <span class="selector-tag">db1</span></span><br><span class="line">    <span class="selector-tag">db-ip</span>      (<span class="attribute">ocf</span>::<span class="attribute">heartbeat</span>:IPaddr2):      <span class="selector-tag">Started</span> <span class="selector-tag">db1</span></span><br></pre></td></tr></table></figure></p>
<p>看到 db-ip 已经在 db1 启动了. 接着验证这个 ip 的设置可以输入<br><figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">server01@server01:</span>~#sudo <span class="built_in">ip</span> addr show eth0</span><br><span class="line"></span><br><span class="line"><span class="number">2</span>: eth0: &lt;BROADCAST,MULTICAST,<span class="meta">UP</span>,LOWER_UP&gt; mtu <span class="number">1500</span> qdisc pfifo_fast state <span class="meta">UP</span> qlen <span class="number">1000</span></span><br><span class="line">    link/ether <span class="number">00</span>:0c:<span class="number">29</span>:0c:<span class="number">0d</span>:<span class="number">69</span> brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet <span class="number">192.168</span><span class="meta">.37</span><span class="meta">.51</span>/<span class="number">24</span> brd <span class="number">192.168</span><span class="meta">.37</span><span class="meta">.255</span> scope <span class="meta">global</span> eth0</span><br><span class="line">    inet <span class="number">192.168</span><span class="meta">.37</span><span class="meta">.50</span>/<span class="number">32</span> brd <span class="number">192.168</span><span class="meta">.37</span><span class="meta">.178</span> scope <span class="meta">global</span> eth0</span><br><span class="line">    inet6 fe80::20c:29ff:fe0c:d69/<span class="number">64</span> scope link</span><br><span class="line">      valid_lft forever preferred_lft forever</span><br></pre></td></tr></table></figure></p>
<p>可以看到这个 192.168.0.250 已经被配置给了 eth0  </p>
<h2 id="配置NFS"><a href="#配置NFS" class="headerlink" title="配置NFS"></a>配置NFS</h2><p>配置 pacemaker 的资源<br><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo crm configure primitive db-nfs lsb:nfs-kernel-server \</span><br><span class="line">    op monitor <span class="attribute">interval</span>=<span class="string">"30s"</span> meta <span class="attribute">target-role</span>=stopped</span><br><span class="line">sudo echo $(sudo crm configure show db-ha-group) db-nfs |sudo crm configure load update -</span><br><span class="line">sudo crm<span class="built_in"> resource </span>start db-nfs</span><br></pre></td></tr></table></figure></p>
<p>最终输入 crm status<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">Online</span>: [ db1 db2 ]</span><br><span class="line"></span><br><span class="line">Master/Slave Set: ms-drbd0 [drbd0]</span><br><span class="line">    <span class="attribute">Masters</span>: [ db1 ]</span><br><span class="line">    <span class="attribute">Slaves</span>: [ db2 ]</span><br><span class="line">Resource Group: db-ha-group</span><br><span class="line">    db-fs      (ocf::heartbeat:Filesystem):    Started db1</span><br><span class="line">    db-ip      (ocf::heartbeat:IPaddr2):      Started db1</span><br><span class="line">    db-pg      (ocf::heartbeat:pgsql): Started db1</span><br><span class="line">    db-nfs    (lsb:nfs-kernel-server):        Started db1</span><br></pre></td></tr></table></figure></p>
<p>可以看到所有的服务都已启动.  </p>
<h1 id="迁移资源"><a href="#迁移资源" class="headerlink" title="迁移资源"></a>迁移资源</h1><p>完成之前配置后, 可以通过 crm status 看到所有资源都在 server01上启动了, 现在我们测试能否将资源转移到 server02上并且根据设计他不应该自动迁移回server01, 我们输入<br><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo crm<span class="built_in"> resource </span>migrate db-ha-group server02</span><br><span class="line">sudo crm<span class="built_in"> resource </span>unmigrate db-ha-group</span><br></pre></td></tr></table></figure></p>
<p>先资源强制分配到 server02, 再取消强制分配. 然后输入 crm_mon, 应该就可以看到资源再慢慢的迁移到 server02, 等一会最终可以看到.<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">Online</span>: [ db1 db2 ]</span><br><span class="line"></span><br><span class="line">Master/Slave Set: ms-drbd0 [drbd0]</span><br><span class="line">    <span class="attribute">Masters</span>: [ db2 ]</span><br><span class="line">    <span class="attribute">Slaves</span>: [ db1 ]</span><br><span class="line">Resource Group: db-ha-group</span><br><span class="line">    db-fs      (ocf::heartbeat:Filesystem):    Started db2</span><br><span class="line">    db-ip      (ocf::heartbeat:IPaddr2):      Started db2</span><br><span class="line">    db-pg      (ocf::heartbeat:pgsql): Started db2</span><br><span class="line">    db-nfs    (lsb:nfs-kernel-server):        Started db2</span><br></pre></td></tr></table></figure></p>
<p>所有的资源都运行于 server02 了. 然后把资源再迁回 server01 可以输入之前的迁移命令也可以简单的重启 pacemaker<br><code>sudo service pacemaker restart</code><br>不一会儿就可以通过 crm status 看到所有的资源又被迁移回了 server01</p>
<p>最后</p>
<p>至此基本的 HA 都已经配置完成了. 基本就是让 pacemaker 来负责程序的启动和调度. 另外还可以通过下列命令来设置 crm.<br><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">crm<span class="built_in"> resource </span>show            # 显示所有的 resource</span><br><span class="line">crm<span class="built_in"> resource </span>cleanup <span class="variable">$&#123;id&#125;</span>    # 清除失败的 action 日志</span><br><span class="line">crm<span class="built_in"> resource </span>stop <span class="variable">$&#123;id&#125;</span>      # 停止某个 resource</span><br><span class="line">crm configure delete <span class="variable">$&#123;id&#125;</span>    # 删除某个配置</span><br><span class="line">crm configure <span class="builtin-name">edit</span>            # 编辑现有的配置文件</span><br></pre></td></tr></table></figure></p>
<h1 id="故障恢复"><a href="#故障恢复" class="headerlink" title="故障恢复"></a>故障恢复</h1><h2 id="一般故障"><a href="#一般故障" class="headerlink" title="一般故障"></a>一般故障</h2><p>1）单机发生故障<br>当server01发生故障，corosync就会切换资源到server02<br>当server01修复了后，就要立即进行系统切换<br>1&gt; 启动服务<br>启动server01-&gt;启动drbd-&gt;启动corosync-&gt;启动pacemaker<br>2&gt; 迁移数据（可选）<br>当数据同步完成后，迁移资源到server01<br>sudo crm resource migrate db-ha-group server01<br>也可选择不迁移  </p>
<p>2)同时掉电<br>启动server01-&gt;启动drbd-&gt;启动corosync-&gt;启动pacemaker  </p>
<p>启动server02-&gt;启动drbd-&gt;启动corosync-&gt;启动pacemaker  </p>
<h2 id="脑裂故障"><a href="#脑裂故障" class="headerlink" title="脑裂故障"></a>脑裂故障</h2><p>1) 断开主(parmary)节点；关机、断开网络或重新配置其他的IP都可以；这里选择的是断开网络  </p>
<p>2)查看两节点状态<br><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[server02@server02 ~]<span class="comment"># drbd-overview</span></span><br><span class="line">  <span class="number">0</span>:drbd<span class="regexp">/0  WFConnection Primary/</span>Unknown UpToDate<span class="regexp">/DUnknown C r----- /m</span>nt ext4 <span class="number">2.0</span>G <span class="number">68</span>M <span class="number">1.9</span>G <span class="number">4</span>%</span><br><span class="line">[root@nod1 ~]<span class="comment"># drbd-overview</span></span><br><span class="line">  <span class="number">0</span>:drbd<span class="regexp">/0  StandAlone Secondary/</span>Unknown UpToDate<span class="regexp">/DUnknown r-----</span></span><br></pre></td></tr></table></figure></p>
<p>由上可以看到两个节点已经无法通信；server02为主节点，server01为备节点  </p>
<p>3)将server01节点升级为主(primary)节点并挂载资源<br><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[server01<span class="variable">@server01</span>~]<span class="comment"># drbdadm primary drbd</span></span><br><span class="line">[server01<span class="variable">@server01</span>~]<span class="comment"># drbd-overview</span></span><br><span class="line">  <span class="number">0</span><span class="symbol">:drbd/</span><span class="number">0</span>  StandAlone Primary/Unknown UpToDate/DUnknown r-----</span><br><span class="line">[server01<span class="variable">@server01</span>~]<span class="comment"># mount /dev/drbd0 /srv/data</span></span><br><span class="line">[server01<span class="variable">@server01</span>~]<span class="comment"># mount | grep drbd0</span></span><br><span class="line">/dev/drbd<span class="number">0</span> on /srv/data type ext4 (rw)</span><br></pre></td></tr></table></figure></p>
<p>4)假如原来的主(primary)节点修复好重新上线了，这时出现了脑裂情况  </p>
<p>5)再次查看两节点的状态<br><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[server01<span class="symbol">@server01</span>~]<span class="meta"># drbdadm role drbd</span></span><br><span class="line">Primary/Unknown</span><br><span class="line">[server02<span class="symbol">@server02</span>~]<span class="meta"># drbdadm role drbd</span></span><br><span class="line">Primary/Unknown</span><br></pre></td></tr></table></figure></p>
<p>6)查看server01与server02连接状态<br><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[server01@server01 ~]<span class="comment"># drbd-overview</span></span><br><span class="line">  <span class="number">0</span>:drbd<span class="regexp">/0  StandAlone Primary/</span>Unknown UpToDate<span class="regexp">/DUnknown r----- /m</span>nt ext4 <span class="number">2.0</span>G <span class="number">68</span>M <span class="number">1.9</span>G <span class="number">4</span>%</span><br><span class="line">[server02@server02 ~]<span class="comment"># drbd-overview</span></span><br><span class="line">  <span class="number">0</span>:drbd<span class="regexp">/0  WFConnection Primary/</span>Unknown UpToDate<span class="regexp">/DUnknown C r----- /m</span>nt ext4 <span class="number">2.0</span>G <span class="number">68</span>M <span class="number">1.9</span>G <span class="number">4</span>%</span><br></pre></td></tr></table></figure></p>
<p>由上可见，状态为StandAlone时，主备节点是不会通信的  </p>
<p>7）查看DRBD的服务状态<br><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[server01@server01 ~]#<span class="built_in"> service </span>drbd status</span><br><span class="line">drbd driver loaded OK; device status:</span><br><span class="line">version: 8.4.3 (api:1/proto:86-101)</span><br><span class="line">GIT-hash: 89a294209144b68adb3ee85a73221f964d3ee515 build by gardner@, 2013-05-27 04:30:21</span><br><span class="line">m:res   cs          ro               ds                 p       mounted  fstype</span><br><span class="line">0:drbd  StandAlone  Primary/Unknown  UpToDate/DUnknown  r-----  ext4</span><br><span class="line">[server02@server02~]#<span class="built_in"> service </span>drbd status</span><br><span class="line">drbd driver loaded OK; device status:</span><br><span class="line">version: 8.4.3 (api:1/proto:86-101)</span><br><span class="line">GIT-hash: 89a294209144b68adb3ee85a73221f964d3ee515 build by gardner@, 2013-05-27 04:30:21</span><br><span class="line">m:res   cs            ro               ds                 p  mounted  fstype</span><br><span class="line">0:drbd  WFConnection  Primary/Unknown  UpToDate/DUnknown  C  /mnt     ext4</span><br></pre></td></tr></table></figure></p>
<p>8) 在server01备用节点处理办法<br><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[server01<span class="variable">@server01</span> ~]<span class="comment"># umount /mnt/</span></span><br><span class="line">[server01<span class="variable">@server01</span> ~]<span class="comment"># drbdadm disconnect drbd</span></span><br><span class="line"><span class="symbol">drbd:</span> <span class="symbol">Failure:</span> (<span class="number">162</span>) Invalid configuration request</span><br><span class="line">additional info from <span class="symbol">kernel:</span></span><br><span class="line">unknown connection</span><br><span class="line">Command <span class="string">'drbdsetup disconnect ipv4:192.168.137.225:7789 ipv4:192.168.137.222:7789'</span> terminated <span class="keyword">with</span> exit code <span class="number">10</span></span><br><span class="line">[server01<span class="variable">@server01</span> ~]<span class="comment"># drbdadm secondary drbd</span></span><br><span class="line">[server01<span class="variable">@server01</span> ~]<span class="comment"># drbd-overview</span></span><br><span class="line">  <span class="number">0</span><span class="symbol">:drbd/</span><span class="number">0</span>  StandAlone Secondary/Unknown UpToDate/DUnknown r-----</span><br><span class="line">[server01<span class="variable">@server01</span> ~]<span class="comment"># drbdadm connect --discard-my-data drbd</span></span><br><span class="line"><span class="comment">######执行完以上三步后，你查看会发现还是不可用</span></span><br><span class="line">[server01<span class="variable">@server01</span> ~]<span class="comment"># drbd-overview</span></span><br><span class="line">  <span class="number">0</span><span class="symbol">:drbd/</span><span class="number">0</span>  WFConnection Secondary/Unknown UpToDate/DUnknown C r-----</span><br></pre></td></tr></table></figure></p>
<p>9） 需要在server02节点上重新建立连接资源<br><code>[server02@server02~]# drbdadm connect drbd</code><br>查看节点连接状态<br><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[server02@server02~]<span class="comment"># drbd-overview</span></span><br><span class="line">  <span class="number">0</span>:drbd<span class="regexp">/0  Connected Primary/</span>Secondary UpToDate<span class="regexp">/UpToDate C r----- /m</span>nt ext4 <span class="number">2.0</span>G <span class="number">68</span>M <span class="number">1.9</span>G <span class="number">4</span>%</span><br><span class="line">[server01@server01 ~]<span class="comment"># drbd-overview</span></span><br><span class="line">  <span class="number">0</span>:drbd<span class="regexp">/0  Connected Secondary/</span>Primary UpToDate<span class="regexp">/UpToDate C r-----</span></span><br></pre></td></tr></table></figure></p>
<p>由上可见已经恢复到正常运行状态  </p>
<p>待恢复完成后<br>卸载掉/srv/data<br>然后启动服务：<br>启动server01-&gt;启动drbd-&gt;启动corosync-&gt;启动pacemaker<br>启动server02-&gt;启动drbd-&gt;启动corosync-&gt;启动pacemaker  </p>
<p>这里要考虑相关的服务的启动顺序。  </p>
<h1 id="安全策略"><a href="#安全策略" class="headerlink" title="安全策略"></a>安全策略</h1><p>1）需进行ip地址权限设定，在交换机上面做安全策略<br>2）建议配置双网卡，直接背对背连接  </p>
<h1 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h1><h2 id="NFS-Client"><a href="#NFS-Client" class="headerlink" title="NFS Client"></a>NFS Client</h2><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">In</span> testing, I chose <span class="keyword">to</span> use this command <span class="keyword">to</span> mount NFS:</span><br><span class="line"></span><br><span class="line">sudo mount -t nfs 192.168.0.250:/srv/data/share /mnt</span><br><span class="line"></span><br><span class="line">sudo dd <span class="attribute">if</span>=/dev/zero <span class="attribute">of</span>=/mnt/test.zero <span class="attribute">bs</span>=1M <span class="attribute">count</span>=4000</span><br></pre></td></tr></table></figure>
<p>生成一个4G的文件<br>同时写入两个4G的文件，并且拷贝1G的文件<br>第一个4G文件的写入速度为9M左右<br>第二个4G文件的写入速度为80M左右<br>第三个1G文件的读取速度为80M左右<br>具体是否满足性能要求还需要设置  </p>
<p><img src="http://7xlvqo.com1.z0.glb.clouddn.com/17b96fee66053e8a5c75e91e5a987d8d.png" alt="NFS测试">  </p>
<h1 id="FAQ"><a href="#FAQ" class="headerlink" title="FAQ"></a>FAQ</h1><pre><code>error:
server02@server02:~$ sudo drbdadm create-md disk1
md_offset 10736365568
al_offset 10736332800
bm_offset 10736005120

Found LVM2 physical volume signature
    10484736 kB data area apparently used
    10484380 kB left usable by current configuration

Device size would be truncated, which
would corrupt data and result in
&apos;access beyond end of device&apos; errors.
You need to either
   * use external meta data (recommended)
   * shrink that filesystem first
   * zero out the device (destroy the filesystem)
Operation refused.

Command &apos;drbdmeta 0 v08 /dev/sdb1 internal create-md&apos; terminated with exit code 40
</code></pre><p>解决:<br><code>sudo dd if=/dev/zero of=/dev/sdb1 bs=1M count=1</code>  </p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    



      <div class="session-wechat" align="center">
        <img alt="关注微信公众号 haibintalk，最新文章主动推送" style="border-width:0" src="http://tp.linqmind.com/2016-12-07-qrcode_for_gh_ff0c28b2feaf_258.jpg">
      </div>
      <div class="session-wechat-tip" align="center">
          关注微信公众号: haibintalk
      </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://www.haibin.me/2016/04/12/Sequelizejs-中文手册/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="haibin">
      <meta itemprop="description" content="Haibin">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="HaibinTalk">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2016/04/12/Sequelizejs-中文手册/" class="post-title-link" itemprop="url">Sequelizejs-中文手册</a>
              
            
          </h1>
        

        <div class="post-meta">

          
          
          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2016-04-12 07:37:03" itemprop="dateCreated datePublished" datetime="2016-04-12T07:37:03+08:00">2016-04-12</time>
            </span>
          

          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2019-07-04 07:28:43" itemprop="dateModified" datetime="2019-07-04T07:28:43+08:00">2019-07-04</time>
              </span>
            
          

          

          
            
            
          

          
          

          

          <br>
          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>最近翻译了一些关于Sequelizejs的文章，希望对大家有帮助<br>文章地址:</p>
<p><a href="https://haibinpark.gitbooks.io/sequelize-zh-manual/content/" target="_blank" rel="noopener">https://haibinpark.gitbooks.io/sequelize-zh-manual/content/</a></p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    



      <div class="session-wechat" align="center">
        <img alt="关注微信公众号 haibintalk，最新文章主动推送" style="border-width:0" src="http://tp.linqmind.com/2016-12-07-qrcode_for_gh_ff0c28b2feaf_258.jpg">
      </div>
      <div class="session-wechat-tip" align="center">
          关注微信公众号: haibintalk
      </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://www.haibin.me/2016/04/10/grunt打包实践/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="haibin">
      <meta itemprop="description" content="Haibin">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="HaibinTalk">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2016/04/10/grunt打包实践/" class="post-title-link" itemprop="url">grunt打包实践</a>
              
            
          </h1>
        

        <div class="post-meta">

          
          
          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2016-04-10 14:29:25" itemprop="dateCreated datePublished" datetime="2016-04-10T14:29:25+08:00">2016-04-10</time>
            </span>
          

          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2019-07-04 07:28:43" itemprop="dateModified" datetime="2019-07-04T07:28:43+08:00">2019-07-04</time>
              </span>
            
          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/工具/" itemprop="url" rel="index"><span itemprop="name">工具</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          <br>
          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="目的"><a href="#目的" class="headerlink" title="目的"></a>目的</h1><p>学会grunt打包<br>并将grunt打包运用于项目实践  </p>
<h1 id="前提"><a href="#前提" class="headerlink" title="前提"></a>前提</h1><ul>
<li>了解 <code>grunt</code> 的作用与用途  </li>
<li>熟悉 <code>nodejs</code>  </li>
<li>熟悉npm的用法  </li>
</ul>
<h1 id="工具链"><a href="#工具链" class="headerlink" title="工具链"></a>工具链</h1><h2 id="grunt-安装"><a href="#grunt-安装" class="headerlink" title="grunt 安装"></a><code>grunt</code> 安装</h2><p>由于我们在开发web项目的时候，都要用 <code>grunt</code> 打包，为了减少重复操作，所以需要安装 <code>grunt</code> 到全局，具体的安装脚本如下:<br><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm <span class="selector-tag">i</span> grunt grunt-cli -g <span class="comment">//安装grunt到全局</span></span><br></pre></td></tr></table></figure></p>
<h2 id="less-安装"><a href="#less-安装" class="headerlink" title="less 安装"></a><code>less</code> 安装</h2><p>由于在项目开发的过程中，我们用到了less,所以提交安装less到全局，具体的安装脚本:</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm <span class="selector-tag">i</span> less@latest -g <span class="comment">//安装less到全局</span></span><br></pre></td></tr></table></figure>
<h1 id="流程"><a href="#流程" class="headerlink" title="流程"></a>流程</h1><p><img src="http://qiniu1.kopbit.com/c8616dc12375f991cd17c3e61b93084e.png" alt="打包流程"></p>
<h1 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h1><h2 id="准备-Grunt-项目"><a href="#准备-Grunt-项目" class="headerlink" title="准备 Grunt 项目"></a>准备 <code>Grunt</code> 项目</h2><p>一般需要在你的项目中添加两份文件：<code>package.json</code> 和 <code>Gruntfile</code>。<br><strong>package.json</strong>: 此文件被<code>npm</code>用于存储项目的元数据，以便将此项目发布为<code>npm</code>模块。你可以在此文件中列出项目依赖的<code>grunt</code>和<code>Grunt插件</code>，放置于<code>devDependencies</code>配置段内。<br><strong>Gruntfile</strong>: 此文件被命名为 <code>Gruntfile.js</code> 或 <code>Gruntfile.coffee</code>，用来配置或定义任务（<code>task</code>）并加载<code>Grunt</code>插件的。 此文档中提到的 <code>Gruntfile</code> 其实说的是一个文件，文件名是 <code>Gruntfile.js</code> 或 <code>Gruntfile.coffee</code>.  </p>
<h2 id="配置-package-json"><a href="#配置-package-json" class="headerlink" title="配置 package.json"></a>配置 <code>package.json</code></h2><figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">"name"</span>: <span class="string">"angularjs-e2e-showcase"</span>,     <span class="comment">//项目名称             </span></span><br><span class="line">  <span class="string">"version"</span>: <span class="string">"1.0.0"</span>,                   <span class="comment">//版本号</span></span><br><span class="line">  <span class="string">"private"</span>: <span class="literal">true</span>,                      <span class="comment">//</span></span><br><span class="line">  <span class="string">"devDependencies"</span>: &#123;                  <span class="comment">//开发依赖</span></span><br><span class="line">    <span class="string">"grunt-contrib-clean"</span>: <span class="string">"0.6.0"</span>,     <span class="comment">//清楚目录或者文件</span></span><br><span class="line">    <span class="string">"grunt-contrib-jshint"</span>: <span class="string">"0.11.0"</span>,   <span class="comment">//js语法检查</span></span><br><span class="line">    <span class="string">"grunt-contrib-concat"</span>: <span class="string">"0.5.1"</span>,    <span class="comment">//合并</span></span><br><span class="line">    <span class="string">"grunt-contrib-uglify"</span>: <span class="string">"0.8.0"</span>,    <span class="comment">//js压缩</span></span><br><span class="line">    <span class="string">"grunt-contrib-watch"</span>: <span class="string">"0.6.1"</span>,     <span class="comment">//监听</span></span><br><span class="line">    <span class="string">"grunt-contrib-cssmin"</span>: <span class="string">"0.13.0"</span>,   <span class="comment">//css严肃哦</span></span><br><span class="line">    <span class="string">"grunt-filerev"</span>: <span class="string">"2.3.1"</span>,           <span class="comment">//文件重命名</span></span><br><span class="line">    <span class="string">"load-grunt-tasks"</span>: <span class="string">"3.2.0"</span>,        <span class="comment">//加载grunt任务</span></span><br><span class="line">    <span class="string">"grunt-usemin"</span>: <span class="string">"3.0.0"</span>,            <span class="comment">//</span></span><br><span class="line">    <span class="string">"grunt-contrib-copy"</span>: <span class="string">"0.8.0"</span>,      <span class="comment">//拷贝</span></span><br><span class="line">    <span class="string">"grunt-contrib-imagemin"</span>: <span class="string">"0.9.4"</span>,  <span class="comment">//生成雪碧图，并对css相关样式做出调整</span></span><br><span class="line">    <span class="string">"karma-coverage"</span>: <span class="string">"0.4.2"</span>,          <span class="comment">//</span></span><br><span class="line">    <span class="string">"grunt-lesslint"</span>: <span class="string">"1.4.1"</span>,          <span class="comment">//less检查</span></span><br><span class="line">    <span class="string">"grunt-contrib-less"</span>: <span class="string">"~1.0.1"</span>,     <span class="comment">//less生成工具</span></span><br><span class="line">    <span class="string">"grunt-contrib-htmlmin"</span>: <span class="string">"0.6.0"</span>,   <span class="comment">//html压缩</span></span><br><span class="line">    <span class="string">"karma-jasmine"</span>: <span class="string">"0.3.6"</span>,           <span class="comment">//</span></span><br><span class="line">    <span class="string">"busboy"</span>: <span class="string">"^0.2.9"</span>,                 <span class="comment">//</span></span><br><span class="line">    <span class="string">"fs-extra"</span>: <span class="string">"^0.16.4"</span>               <span class="comment">//</span></span><br><span class="line">  &#125;                                     <span class="comment">//</span></span><br></pre></td></tr></table></figure>
<p>安装依赖包，安装命令<br><code>npm i</code><br>如果是国内的话，可以使用 <code>taoao</code>的npm安装源<br><figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">npm</span> i nrm -g  </span><br><span class="line">nrm use taobao  </span><br><span class="line"><span class="built_in">npm</span> i</span><br></pre></td></tr></table></figure></p>
<h2 id="建立-Gruntfile-文件结构"><a href="#建立-Gruntfile-文件结构" class="headerlink" title="建立 Gruntfile 文件结构"></a>建立 <code>Gruntfile</code> 文件结构</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Created by david on 4/10/2016.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span> (<span class="params">grunt</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">require</span>(<span class="string">'load-grunt-tasks'</span>)(grunt); <span class="comment">//加载 load-grunt-tasks grunt插件</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//定义路径变量</span></span><br><span class="line">    <span class="keyword">var</span> path = &#123;</span><br><span class="line">        tmp: <span class="string">'.tmp'</span>,                        <span class="comment">//临时目录</span></span><br><span class="line">        dest: <span class="string">'.publish'</span>,                   <span class="comment">//发布目录</span></span><br><span class="line">        web: <span class="string">''</span>  <span class="comment">//项目站点</span></span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//项目配置文件</span></span><br><span class="line">    grunt.initConfig(&#123;</span><br><span class="line"></span><br><span class="line">      pkg: grunt.file.readJSON(<span class="string">'package.json'</span>),</span><br><span class="line">      path: path, <span class="comment">//申明变量</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">//清楚文件和目录</span></span><br><span class="line">        clean:&#123;</span><br><span class="line"></span><br><span class="line">        &#125;,</span><br><span class="line"></span><br><span class="line">        <span class="comment">//编译less文件为css</span></span><br><span class="line">        less:&#123;</span><br><span class="line"></span><br><span class="line">        &#125;,</span><br><span class="line"></span><br><span class="line">        <span class="comment">//生成雪碧图，并修改相应的css文件</span></span><br><span class="line">        sprite:&#123;</span><br><span class="line"></span><br><span class="line">        &#125;,</span><br><span class="line"></span><br><span class="line">        <span class="comment">//拷贝文件</span></span><br><span class="line">        copy:&#123;</span><br><span class="line"></span><br><span class="line">        &#125;,</span><br><span class="line"></span><br><span class="line">        <span class="comment">//合并文件</span></span><br><span class="line">        concat:&#123;</span><br><span class="line"></span><br><span class="line">        &#125;,</span><br><span class="line"></span><br><span class="line">        <span class="comment">//压缩css</span></span><br><span class="line">        cssmin:&#123;</span><br><span class="line"></span><br><span class="line">        &#125;,</span><br><span class="line"></span><br><span class="line">        <span class="comment">//压缩Js</span></span><br><span class="line">        uglify:&#123;</span><br><span class="line"></span><br><span class="line">        &#125;,</span><br><span class="line"></span><br><span class="line">        <span class="comment">//文件重命名</span></span><br><span class="line">        filerev:&#123;</span><br><span class="line"></span><br><span class="line">        &#125;,</span><br><span class="line"></span><br><span class="line">        <span class="comment">//替换文件前准备</span></span><br><span class="line">        useminPrepare:&#123;</span><br><span class="line"></span><br><span class="line">        &#125;,</span><br><span class="line"></span><br><span class="line">        <span class="comment">//替换文件</span></span><br><span class="line">        usemin:&#123;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    grunt.registerTask(</span><br><span class="line">        <span class="string">'build'</span>, <span class="comment">//分组名称</span></span><br><span class="line">        [        <span class="comment">//该分组包含的任务</span></span><br><span class="line">            <span class="string">'clean:beforebuild'</span>,</span><br><span class="line">            <span class="string">'less'</span>,</span><br><span class="line">            <span class="string">'sprite'</span>,</span><br><span class="line">            <span class="string">'copy'</span>,</span><br><span class="line">            <span class="string">'concat'</span>,</span><br><span class="line">            <span class="string">'cssmin'</span>,</span><br><span class="line">            <span class="string">'uglify'</span>,</span><br><span class="line">            <span class="string">'filerev'</span>,</span><br><span class="line">            <span class="string">'useminPrepare'</span>,</span><br><span class="line">            <span class="string">'usemin'</span>,</span><br><span class="line">            <span class="string">'clean:afterbuild'</span></span><br><span class="line">        ]</span><br><span class="line">    );</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="清除文件目录"><a href="#清除文件目录" class="headerlink" title="清除文件目录"></a>清除文件目录</h3><p>该任务包含两个子任务:  </p>
<ul>
<li><p>构建前执行脚本<br>清除 <code>dest</code>，与 <code>tmp</code> 相关目录与文件</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">beforebuild</span>: &#123;</span><br><span class="line">    <span class="attribute">files</span>: [&#123;</span><br><span class="line">        src: [<span class="string">'&lt;%= path.dest %&gt;/'</span>, <span class="string">'&lt;%= path.tmp %&gt;/'</span>]</span><br><span class="line">    &#125;]</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
</li>
<li><p>构建后执行脚本<br>清除 <code>tmp</code> 相关目录与文件</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">afterbuild</span>: &#123;</span><br><span class="line">     <span class="attribute">files</span>: [&#123;</span><br><span class="line">         src: [<span class="string">'&lt;%= path.tmp %&gt;/'</span>]</span><br><span class="line">     &#125;]</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="编译less文件"><a href="#编译less文件" class="headerlink" title="编译less文件"></a>编译less文件</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">baseStyleCss:</span> <span class="string">&#123;</span></span><br><span class="line"><span class="attr">     options:</span> <span class="string">&#123;</span></span><br><span class="line"><span class="attr">         strictMath:</span> <span class="literal">true</span><span class="string">,</span></span><br><span class="line"><span class="attr">         sourceMap:</span> <span class="literal">true</span><span class="string">,</span></span><br><span class="line"><span class="attr">         outputSourceFiles:</span> <span class="literal">true</span></span><br><span class="line">     <span class="string">&#125;,</span></span><br><span class="line"><span class="attr">     src:</span> <span class="string">'content/stylesheet/less/config.less'</span><span class="string">,</span> <span class="string">//该less文件将导入其他的less文件</span></span><br><span class="line"><span class="attr">     dest:</span> <span class="string">'content/stylesheet/css/config.css'</span></span><br><span class="line"> <span class="string">&#125;</span></span><br></pre></td></tr></table></figure>
<h3 id="生成雪碧图"><a href="#生成雪碧图" class="headerlink" title="生成雪碧图"></a>生成雪碧图</h3><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">options</span>: &#123;</span><br><span class="line">    <span class="comment">// 给雪碧图追加时间戳，默认不追加</span></span><br><span class="line">    <span class="attribute">spritestamp</span>: true</span><br><span class="line">&#125;,</span><br><span class="line"><span class="comment">// image-set 示例</span></span><br><span class="line"><span class="attribute">imageKityMinderSprite</span>: &#123;</span><br><span class="line">    <span class="attribute">options</span>: &#123;</span><br><span class="line">        <span class="attribute">useimageset</span>: true,</span><br><span class="line">        <span class="attribute">imagepath</span>: <span class="string">"content/images/slice/"</span>,         <span class="comment">//less文件应用图片的目录地址</span></span><br><span class="line">        <span class="attribute">spritedest</span>: <span class="string">'&lt;%= path.tmp%&gt;/images/slice/'</span>  <span class="comment">//生成后的雪碧图目录地址</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attribute">files</span>: [&#123;</span><br><span class="line">        <span class="comment">// 启用动态扩展</span></span><br><span class="line">        <span class="attribute">expand</span>: true,</span><br><span class="line">        <span class="comment">// css文件源的文件夹</span></span><br><span class="line">        <span class="attribute">cwd</span>: <span class="string">'content/stylesheet/css'</span>,</span><br><span class="line">        <span class="comment">// 匹配规则</span></span><br><span class="line">        <span class="attribute">src</span>: <span class="string">'*.css'</span>,</span><br><span class="line">        <span class="comment">// 导出css和sprite的路径地址</span></span><br><span class="line">        <span class="attribute">dest</span>: <span class="string">'&lt;%= path.tmp%&gt;/css/'</span>,</span><br><span class="line">        <span class="comment">// 导出的css名</span></span><br><span class="line">        <span class="attribute">ext</span>: <span class="string">'.sprite.css'</span></span><br><span class="line">    &#125;]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="拷贝文件"><a href="#拷贝文件" class="headerlink" title="拷贝文件"></a>拷贝文件</h3><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">fonts</span>: &#123;                                     <span class="comment">//拷贝字体</span></span><br><span class="line">     <span class="attribute">expand</span>: true,                           <span class="comment">//展开</span></span><br><span class="line">     <span class="attribute">cwd</span>: <span class="string">'content/fonts/'</span>,                  <span class="comment">//改变当前路径</span></span><br><span class="line">     <span class="attribute">src</span>: [<span class="string">'**'</span>],                            <span class="comment">//匹配文件的正则表达式</span></span><br><span class="line">     <span class="attribute">dest</span>: <span class="string">'&lt;%= path.dest %&gt;/fonts/'</span>,        <span class="comment">//</span></span><br><span class="line">     <span class="attribute">flatten</span>: false                          <span class="comment">//</span></span><br><span class="line"> &#125;,                                          <span class="comment">//拷贝图片</span></span><br><span class="line"> <span class="attribute">images</span>: &#123;                                   <span class="comment">//</span></span><br><span class="line">     <span class="attribute">expand</span>: true,                           <span class="comment">//</span></span><br><span class="line">     <span class="attribute">cwd</span>: <span class="string">'content/images/other'</span>,            <span class="comment">//</span></span><br><span class="line">     <span class="attribute">src</span>: [<span class="string">'**'</span>],                            <span class="comment">//</span></span><br><span class="line">     <span class="attribute">dest</span>: <span class="string">'&lt;%= path.dest%&gt;/images/other'</span>,   <span class="comment">//</span></span><br><span class="line">     <span class="attribute">flatten</span>: false                          <span class="comment">//</span></span><br><span class="line"> &#125;,                                          <span class="comment">//拷贝雪碧图</span></span><br><span class="line"> <span class="attribute">spriteImages</span>: &#123;                             <span class="comment">//</span></span><br><span class="line">     <span class="attribute">expand</span>: true,                           <span class="comment">//</span></span><br><span class="line">     <span class="attribute">cwd</span>: <span class="string">'&lt;%= path.tmp%&gt;/images/slice'</span>,     <span class="comment">//</span></span><br><span class="line">     <span class="attribute">src</span>: [<span class="string">'**'</span>],                            <span class="comment">//</span></span><br><span class="line">     <span class="attribute">dest</span>: <span class="string">'&lt;%= path.dest%&gt;/images/slice'</span>,   <span class="comment">//</span></span><br><span class="line">     <span class="attribute">flatten</span>: false                          <span class="comment">//</span></span><br><span class="line"> &#125;,                                          <span class="comment">//拷贝站点小图标</span></span><br><span class="line"> <span class="attribute">ico</span>: &#123;                                      <span class="comment">//</span></span><br><span class="line">     <span class="attribute">src</span>: <span class="string">'favicon.ico'</span>,                     <span class="comment">//</span></span><br><span class="line">     <span class="attribute">dest</span>: <span class="string">'&lt;%= path.dest%&gt;/'</span>                <span class="comment">//</span></span><br><span class="line"> &#125;,                                          <span class="comment">//</span></span><br><span class="line"> <span class="attribute">indexCopy</span>: &#123;                                <span class="comment">//拷贝index.html</span></span><br><span class="line">     <span class="attribute">expand</span>: true,                           <span class="comment">//</span></span><br><span class="line">     <span class="attribute">src</span>: [<span class="string">'index.html'</span>],                    <span class="comment">//</span></span><br><span class="line">     <span class="attribute">dest</span>: <span class="string">'&lt;%= path.dest%&gt;/'</span>,               <span class="comment">//</span></span><br><span class="line">     <span class="attribute">flatten</span>: false                          <span class="comment">//</span></span><br><span class="line"> &#125;,                                          <span class="comment">//</span></span><br><span class="line"> <span class="attribute">appViewsCopy</span>: &#123;                             <span class="comment">//拷贝应用相关html文件</span></span><br><span class="line">     <span class="attribute">expand</span>: true,                           <span class="comment">//</span></span><br><span class="line">     <span class="attribute">cwd</span>: <span class="string">'app/'</span>,                            <span class="comment">//</span></span><br><span class="line">     <span class="attribute">src</span>: [<span class="string">'**/**.html'</span>],                    <span class="comment">//</span></span><br><span class="line">     <span class="attribute">dest</span>: <span class="string">'&lt;%= path.dest%&gt;/app/'</span>,           <span class="comment">//</span></span><br><span class="line">     <span class="attribute">flatten</span>: false                          <span class="comment">//</span></span><br><span class="line"> &#125;                                           <span class="comment">//</span></span><br></pre></td></tr></table></figure>
<h3 id="合并文件"><a href="#合并文件" class="headerlink" title="合并文件"></a>合并文件</h3><figure class="highlight roboconf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line">baseCss: &#123; //合并<span class="attribute">css</span></span><br><span class="line"><span class="attribute">    src</span>: [</span><br><span class="line">        "bower_components/bootstrap/dist/css/bootstrap<span class="variable">.css</span>",</span><br><span class="line">        "bower_components/angular/angular-csp<span class="variable">.css</span>",</span><br><span class="line">        "bower_components/color-picker/dist/color-picker<span class="variable">.css</span>",</span><br><span class="line">        "bower_components/codemirror/lib/codemirror<span class="variable">.css</span>",</span><br><span class="line">        "bower_components/hotbox/hotbox<span class="variable">.css</span>",</span><br><span class="line">        "<span class="variable">.tmp</span>/css/config<span class="variable">.sprite</span><span class="variable">.css</span>"</span><br><span class="line">    ],</span><br><span class="line">    dest: "&lt;%= path<span class="variable">.tmp</span>%&gt;/css/showcase<span class="variable">.css</span>"</span><br><span class="line">&#125;,</span><br><span class="line">kityminderJs: &#123;</span><br><span class="line">    src: [ //合并js</span><br><span class="line">        "bower_components/angular/angular<span class="variable">.js</span>",</span><br><span class="line">        "bower_components/jquery/dist/jquery<span class="variable">.js</span>",</span><br><span class="line">        "bower_components/bootstrap/dist/js/bootstrap<span class="variable">.js</span>",</span><br><span class="line">        "bower_components/angular-bootstrap/ui-bootstrap<span class="variable">.js</span>",</span><br><span class="line">        "bower_components/angular-bootstrap/ui-bootstrap-tpls<span class="variable">.js</span>",</span><br><span class="line">        "bower_components/seajs/dist/sea-debug<span class="variable">.js</span>",</span><br><span class="line">        "bower_components/color-picker/src/color-picker<span class="variable">.js</span>",</span><br><span class="line">        "bower_components/codemirror/lib/codemirror<span class="variable">.js</span>",</span><br><span class="line">        "bower_components/codemirror/mode/xml/xml<span class="variable">.js</span>",</span><br><span class="line">        "bower_components/codemirror/mode/javascript/javascript<span class="variable">.js</span>",</span><br><span class="line">        "bower_components/codemirror/mode/css/css<span class="variable">.js</span>",</span><br><span class="line">        "bower_components/codemirror/mode/htmlmixed/htmlmixed<span class="variable">.js</span>",</span><br><span class="line">        "bower_components/codemirror/mode/markdown/markdown<span class="variable">.js</span>",</span><br><span class="line">        "bower_components/codemirror/addon/mode/overlay<span class="variable">.js</span>",</span><br><span class="line">        "bower_components/codemirror/mode/gfm/gfm<span class="variable">.js</span>",</span><br><span class="line">        "bower_components/angular-ui-codemirror/ui-codemirror<span class="variable">.js</span>",</span><br><span class="line">        "bower_components/kity/dist/kity<span class="variable">.js</span>",</span><br><span class="line">        "bower_components/hotbox/hotbox<span class="variable">.js</span>",</span><br><span class="line">        "lib/kityminder/src/kityminder<span class="variable">.js</span>",</span><br><span class="line">        "bower_components/marked/lib/marked<span class="variable">.js</span>",</span><br><span class="line">        "app/kityminder/kityminder<span class="variable">.app</span><span class="variable">.js</span>",</span><br><span class="line">        "app/kityminder/templates<span class="variable">.js</span>",</span><br><span class="line">        "app/kityminder/service/commandBinder<span class="variable">.service</span><span class="variable">.js</span>",</span><br><span class="line">        "app/kityminder/service/config<span class="variable">.service</span><span class="variable">.js</span>",</span><br><span class="line">        "app/kityminder/service/memory<span class="variable">.service</span><span class="variable">.js</span>",</span><br><span class="line">        "app/kityminder/service/lang<span class="variable">.zh-cn</span><span class="variable">.service</span><span class="variable">.js</span>",</span><br><span class="line">        "app/kityminder/service/valueTransfer<span class="variable">.service</span><span class="variable">.js</span>",</span><br><span class="line">        "app/kityminder/service/minder<span class="variable">.service</span><span class="variable">.js</span>",</span><br><span class="line">        "app/kityminder/service/resource<span class="variable">.service</span><span class="variable">.js</span>",</span><br><span class="line">        "app/kityminder/service/revokeDialog<span class="variable">.service</span><span class="variable">.js</span>",</span><br><span class="line">        "app/_filter/lang<span class="variable">.filter</span><span class="variable">.js</span>",</span><br><span class="line">        "app/_directive/kityminder/topTab/topTab<span class="variable">.directive</span><span class="variable">.js</span>",</span><br><span class="line">        "app/_directive/kityminder/undoRedo/undoRedo<span class="variable">.directive</span><span class="variable">.js</span>",</span><br><span class="line">        "app/_directive/kityminder/appendNode/appendNode<span class="variable">.directive</span><span class="variable">.js</span>",</span><br><span class="line">        "app/_directive/kityminder/arrange/arrange<span class="variable">.directive</span><span class="variable">.js</span>",</span><br><span class="line">        "app/_directive/kityminder/operation/operation<span class="variable">.directive</span><span class="variable">.js</span>",</span><br><span class="line">        "app/_directive/kityminder/hyperLink/hyperLink<span class="variable">.directive</span><span class="variable">.js</span>",</span><br><span class="line">        "app/_directive/kityminder/imageBtn/imageBtn<span class="variable">.directive</span><span class="variable">.js</span>",</span><br><span class="line">        "app/_directive/kityminder/noteBtn/noteBtn<span class="variable">.directive</span><span class="variable">.js</span>",</span><br><span class="line">        "app/_directive/kityminder/resourceEditor/resourceEditor<span class="variable">.directive</span><span class="variable">.js</span>",</span><br><span class="line">        "app/_directive/kityminder/priorityEditor/priorityEditor<span class="variable">.directive</span><span class="variable">.js</span>",</span><br><span class="line">        "app/_directive/kityminder/progressEditor/progressEditor<span class="variable">.directive</span><span class="variable">.js</span>",</span><br><span class="line">        "app/_directive/kityminder/noteEditor/noteEditor<span class="variable">.directive</span><span class="variable">.js</span>",</span><br><span class="line">        "app/_directive/kityminder/notePreviewer/notePreviewer<span class="variable">.directive</span><span class="variable">.js</span>",</span><br><span class="line">        "app/_directive/kityminder/templateList/templateList<span class="variable">.directive</span><span class="variable">.js</span>",</span><br><span class="line">        "app/_directive/kityminder/themeList/themeList<span class="variable">.directive</span><span class="variable">.js</span>",</span><br><span class="line">        "app/_directive/kityminder/layout/layout<span class="variable">.directive</span><span class="variable">.js</span>",</span><br><span class="line">        "app/_directive/kityminder/styleOperator/styleOperator<span class="variable">.directive</span><span class="variable">.js</span>",</span><br><span class="line">        "app/_directive/kityminder/fontOperator/fontOperator<span class="variable">.directive</span><span class="variable">.js</span>",</span><br><span class="line">        "app/_directive/kityminder/expandLevel/expandLevel<span class="variable">.directive</span><span class="variable">.js</span>",</span><br><span class="line">        "app/_directive/kityminder/selectAll/selectAll<span class="variable">.directive</span><span class="variable">.js</span>",</span><br><span class="line">        "app/_directive/kityminder/colorPanel/colorPanel<span class="variable">.directive</span><span class="variable">.js</span>",</span><br><span class="line">        "app/_directive/kityminder/navigator/navigator<span class="variable">.directive</span><span class="variable">.js</span>",</span><br><span class="line">        "app/_directive/kityminder/searchBox/searchBox<span class="variable">.directive</span><span class="variable">.js</span>",</span><br><span class="line">        "app/_directive/kityminder/searchBtn/searchBtn<span class="variable">.directive</span><span class="variable">.js</span>",</span><br><span class="line">        "app/kityminder/dialog/hyperlink/hyperlink<span class="variable">.ctrl</span><span class="variable">.js</span>",</span><br><span class="line">        "app/kityminder/dialog/image/image<span class="variable">.ctrl</span><span class="variable">.js</span>",</span><br><span class="line">        "app/kityminder/dialog/im-export-node/imExportNode<span class="variable">.ctrl</span><span class="variable">.js</span>",</span><br><span class="line">        "app/_directive/kityminder/kityminderEditor/kityminderEditor<span class="variable">.directive</span><span class="variable">.js</span>",</span><br><span class="line">        "lib/kityminder/src/expose-kityminder<span class="variable">.js</span>",</span><br><span class="line">        "app/app<span class="variable">.module</span><span class="variable">.js</span>",</span><br><span class="line">        "app/kityminder/kityminder-main-controller<span class="variable">.js</span>"</span><br><span class="line">    ],</span><br><span class="line">    dest: "&lt;%= path<span class="variable">.tmp</span>%&gt;/js/showcase<span class="variable">.js</span>"</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="压缩css"><a href="#压缩css" class="headerlink" title="压缩css"></a>压缩css</h3><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">kopBaseCss</span>: &#123;</span><br><span class="line">    <span class="attribute">src</span>: [<span class="string">"&lt;%= path.tmp%&gt;/css/showcase.css"</span>],</span><br><span class="line">    dest: <span class="string">"&lt;%= path.dest %&gt;/css/showcase.css"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="压缩Js"><a href="#压缩Js" class="headerlink" title="压缩Js"></a>压缩Js</h3><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">baseJs</span>: &#123;</span><br><span class="line">    <span class="attribute">src</span>: <span class="string">"&lt;%= path.tmp%&gt;/js/showcase.js"</span>,</span><br><span class="line">    dest: <span class="string">"&lt;%= path.dest%&gt;/js/showcase.js"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="文件重命名"><a href="#文件重命名" class="headerlink" title="文件重命名"></a>文件重命名</h3><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">build</span>: &#123;</span><br><span class="line">    <span class="attribute">files</span>: [&#123;</span><br><span class="line">        src: [<span class="string">'&lt;%= path.dest %&gt;/js/**.js'</span>, <span class="string">'&lt;%= path.dest %&gt;/css/**'</span>] //只是对js于css重新命名</span><br><span class="line">    &#125;]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="替换文件前准备"><a href="#替换文件前准备" class="headerlink" title="替换文件前准备"></a>替换文件前准备</h3><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">html</span>: <span class="string">'&lt;%= path.dest %/**/*.html'</span>,</span><br><span class="line"> <span class="attribute">options</span>: &#123;</span><br><span class="line">     <span class="attribute">dest</span>: <span class="string">'./&lt;%= path.dest %&gt;'</span>,</span><br><span class="line">     <span class="attribute">root</span>: <span class="string">'./&lt;%= path.dest %&gt;'</span></span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<h3 id="替换文件"><a href="#替换文件" class="headerlink" title="替换文件"></a>替换文件</h3><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">html</span>: &#123;</span><br><span class="line">    <span class="attribute">files</span>: [&#123;</span><br><span class="line">        src: <span class="string">'&lt;%= path.dest %&gt;/**/*.html'</span></span><br><span class="line">    &#125;]</span><br><span class="line">&#125;,</span><br><span class="line"><span class="selector-tag">options</span>: &#123;</span><br><span class="line">    <span class="attribute">assetsDirs</span>: [<span class="string">'&lt;%= path.dest %&gt;'</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="实例"><a href="#实例" class="headerlink" title="实例"></a>实例</h1><p>项目地址传送门:<br><a href="https://github.com/haibinpark/angular-e2etest-showcase.git" target="_blank" rel="noopener">https://github.com/haibinpark/angular-e2etest-showcase.git</a></p>
<h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><p><a href="http://gruntjs.com/" target="_blank" rel="noopener">Gruntjs官方网站</a><br><a href="http://www.gruntjs.net/" target="_blank" rel="noopener">Gruntjs中文网站</a></p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    



      <div class="session-wechat" align="center">
        <img alt="关注微信公众号 haibintalk，最新文章主动推送" style="border-width:0" src="http://tp.linqmind.com/2016-12-07-qrcode_for_gh_ff0c28b2feaf_258.jpg">
      </div>
      <div class="session-wechat-tip" align="center">
          关注微信公众号: haibintalk
      </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://www.haibin.me/2016/02/07/ATOM 快速上手文档/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="haibin">
      <meta itemprop="description" content="Haibin">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="HaibinTalk">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2016/02/07/ATOM 快速上手文档/" class="post-title-link" itemprop="url">ATOM 快速上手文档</a>
              
            
          </h1>
        

        <div class="post-meta">

          
          
          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2016-02-07 12:48:02" itemprop="dateCreated datePublished" datetime="2016-02-07T12:48:02+08:00">2016-02-07</time>
            </span>
          

          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2019-07-04 07:28:43" itemprop="dateModified" datetime="2019-07-04T07:28:43+08:00">2019-07-04</time>
              </span>
            
          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/OSX-atom-tools-工具/" itemprop="url" rel="index"><span itemprop="name">OSX atom tools 工具</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          <br>
          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <ul>
<li><a href="#atom-快速上手文档">ATOM 快速上手文档</a><ul>
<li><a href="#安装nodejs">安装nodejs</a></li>
<li><a href="#安装-atom">安装 atom</a></li>
<li><a href="#代理设置">代理设置</a></li>
<li><a href="#安装常用插件">安装常用插件</a></li>
<li><a href="#如何安装插件">如何安装插件</a></li>
<li><a href="#atom配置">atom配置</a><ul>
<li><a href="#配置七牛">配置七牛</a></li>
<li><a href="#修改源码文件">修改源码文件</a></li>
</ul>
</li>
<li><a href="#atom-使用小技巧">atom 使用小技巧</a><ul>
<li><a href="#tips1">tips1</a></li>
</ul>
</li>
<li><a href="#tips2">tips2</a><ul>
<li><a href="#tips3">tips3</a></li>
<li><a href="#tip4">tip4</a></li>
</ul>
</li>
<li><a href="#使用错误">使用错误</a></li>
<li><a href="#参考链接">参考链接</a></li>
</ul>
</li>
</ul>
<h1 id="ATOM-快速上手文档"><a href="#ATOM-快速上手文档" class="headerlink" title="ATOM 快速上手文档"></a>ATOM 快速上手文档</h1><h2 id="安装nodejs"><a href="#安装nodejs" class="headerlink" title="安装nodejs"></a>安装nodejs</h2><p>略  </p>
<h2 id="安装-atom"><a href="#安装-atom" class="headerlink" title="安装 atom"></a>安装 atom</h2><p>略  </p>
<h2 id="代理设置"><a href="#代理设置" class="headerlink" title="代理设置"></a>代理设置</h2><blockquote>
<p>由于我们伟大的墙，所以我们需要进行代理设置<br>代理我们可以使用shadowsocks    </p>
</blockquote>
<p>安装Atom后,打开C:\Users\xxx\下的.atom文件夹里的.apmrc文件,添加以下三行配置即可:  </p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">http-proxy</span>=http://<span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">1080</span></span><br><span class="line"><span class="attr">https-proxy</span>=http://<span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">1080</span></span><br><span class="line"><span class="attr">strict-ssl</span>=<span class="literal">false</span></span><br></pre></td></tr></table></figure>
<p>如果找不到.apmrc文件,就从.apm文件夹里复制一个出来.</p>
<h2 id="安装常用插件"><a href="#安装常用插件" class="headerlink" title="安装常用插件"></a>安装常用插件</h2><blockquote>
<p>这些插件写文档基本够用了  </p>
</blockquote>
<ul>
<li>Markdown Assistant  </li>
<li>Qiniu-uploader  </li>
<li>Git-Plus  </li>
<li>Merge Conflicts  </li>
<li>Markdown preview plus</li>
</ul>
<h2 id="如何安装插件"><a href="#如何安装插件" class="headerlink" title="如何安装插件"></a>如何安装插件</h2><p>按住ctrl+, 这个组合键，即可进入atom配置界面<br>选择<code>+Install</code>  </p>
<p><img src="http://7xphqb.com1.z0.glb.clouddn.com/cfbdd3816740380930fdb1b7ff5b2f7e.png" alt="安装相关插件页面"></p>
<h2 id="atom配置"><a href="#atom配置" class="headerlink" title="atom配置"></a>atom配置</h2><h3 id="配置七牛"><a href="#配置七牛" class="headerlink" title="配置七牛"></a>配置七牛</h3><p>由于我们使用的是qiniu的图床，所以要配置qiniu-uploader  </p>
<p>具体参数的获取方法，上面都有相对应的说明  </p>
<p><img src="http://7xphqb.com1.z0.glb.clouddn.com/0ac312cde75753f7416f082a42369220.png" alt="七牛相关配置信息"></p>
<h3 id="修改源码文件"><a href="#修改源码文件" class="headerlink" title="修改源码文件"></a>修改源码文件</h3><p>由于复制粘贴有些问题，所以需要对markdown-assistant源码做少许修改<br>修改路径<br><code>C:\Users\xxx\.atom\packages\markdown-assistant\lib\main.coffee</code><br>将33行的<code>e.mataKey</code>替换为<code>e.ctrKey</code>  </p>
<h2 id="atom-使用小技巧"><a href="#atom-使用小技巧" class="headerlink" title="atom 使用小技巧"></a>atom 使用小技巧</h2><h3 id="tips1"><a href="#tips1" class="headerlink" title="tips1"></a>tips1</h3><p>ctrl+shift+a 快捷键添加单个文件  </p>
<h2 id="tips2"><a href="#tips2" class="headerlink" title="tips2"></a>tips2</h2><p>ctrl+shift+x 快捷键提交当前修改  </p>
<h3 id="tips3"><a href="#tips3" class="headerlink" title="tips3"></a>tips3</h3><p>ctrl+shift+h 快捷键打开git命令窗口  </p>
<h3 id="tip4"><a href="#tip4" class="headerlink" title="tip4"></a>tip4</h3><p>使用<code>unset!</code>取消快捷键<br><figure class="highlight sml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">'atom</span>-workspace, atom-workspace atom-text-editor':</span><br><span class="line">  <span class="symbol">'ctrl</span>-shift-<span class="type">X'</span>: <span class="symbol">'unset</span>!<span class="string">'</span></span><br></pre></td></tr></table></figure></p>
<h2 id="使用错误"><a href="#使用错误" class="headerlink" title="使用错误"></a>使用错误</h2><p>这里的主要错误是atom插件的安装错误<br><code>atom tunneling socket could not be established, cause=Parse Error</code><br>这个错误的原因是由于代理设置的问题，我使用的是sockets代理，要转为http代理  </p>
<pre><code>brew install polipo  
polipo socksParentProxy=localhost:1080
</code></pre><p>这样就会产生一个新的端口<br><code>Established listening socket on port 8123.</code>  将上面的端口号修改为<code>8123</code>即可</p>
<h2 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h2><p><a href="http://www.jianshu.com/p/85b11364fa1c" target="_blank" rel="noopener">http://www.jianshu.com/p/85b11364fa1c</a><br><a href="http://blog.csdn.net/crper/article/details/48056435" target="_blank" rel="noopener">http://blog.csdn.net/crper/article/details/48056435</a>  </p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    



      <div class="session-wechat" align="center">
        <img alt="关注微信公众号 haibintalk，最新文章主动推送" style="border-width:0" src="http://tp.linqmind.com/2016-12-07-qrcode_for_gh_ff0c28b2feaf_258.jpg">
      </div>
      <div class="session-wechat-tip" align="center">
          关注微信公众号: haibintalk
      </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://www.haibin.me/2015/11/13/nodejs课程学习第2课/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="haibin">
      <meta itemprop="description" content="Haibin">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="HaibinTalk">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2015/11/13/nodejs课程学习第2课/" class="post-title-link" itemprop="url">nodejs课程学习第2课</a>
              
            
          </h1>
        

        <div class="post-meta">

          
          
          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2015-11-13 20:10:52" itemprop="dateCreated datePublished" datetime="2015-11-13T20:10:52+08:00">2015-11-13</time>
            </span>
          

          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2019-07-04 07:28:43" itemprop="dateModified" datetime="2019-07-04T07:28:43+08:00">2019-07-04</time>
              </span>
            
          

          

          
            
            
          

          
          

          

          <br>
          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="课程目标"><a href="#课程目标" class="headerlink" title="课程目标"></a>课程目标</h2><ul>
<li>建立nodejs web项目  </li>
<li>nodejs web框架的常用函数的使用方法  </li>
<li>代码托管Gitlab与github  </li>
<li>私有镜像Docker部署  </li>
</ul>
<h2 id="课程内容"><a href="#课程内容" class="headerlink" title="课程内容"></a>课程内容</h2><h3 id="基础工具准备"><a href="#基础工具准备" class="headerlink" title="基础工具准备"></a>基础工具准备</h3><h4 id="安装nodejs"><a href="#安装nodejs" class="headerlink" title="安装nodejs"></a>安装nodejs</h4><ul>
<li>windows安装<br>略  </li>
<li>osx下安装  </li>
</ul>
<figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">brew </span><span class="keyword">install </span>nodejs</span><br></pre></td></tr></table></figure>
<ul>
<li>ubuntu 安装  </li>
</ul>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">apt-<span class="builtin-name">get</span> update -y</span><br><span class="line">apt-<span class="builtin-name">get</span> install nodejs -y</span><br></pre></td></tr></table></figure>
<h4 id="安装web-strom"><a href="#安装web-strom" class="headerlink" title="安装web strom"></a>安装web strom</h4><p>现在体验了一圈，用的比较顺手的还是web storm，安装方法我这里就不一一演示了,如果经济条件允许，建议大家购买正版吧，建议大家购买的软件版本为webstorm 11，主要这个版本，可以为使用javascript测试框架mocha<br>略   </p>
<h4 id="建立nodejs项目"><a href="#建立nodejs项目" class="headerlink" title="建立nodejs项目"></a>建立nodejs项目</h4><h3 id="nodejs-express框架"><a href="#nodejs-express框架" class="headerlink" title="nodejs express框架"></a>nodejs express框架</h3><p>nodejs express框架，包括几个比较常用的函数，大家理解对代码编写很有帮助的。  </p>
<ul>
<li><p>require<br>require包含的主要作用是包含第三方模块  </p>
</li>
<li><p>app.use  </p>
</li>
</ul>
<ul>
<li>app.get;app.post;app.put;app.delete  </li>
</ul>
<ul>
<li>app.set方法  </li>
</ul>
<h3 id="代码托管"><a href="#代码托管" class="headerlink" title="代码托管"></a>代码托管</h3><p>现在代码托管代码的方式有两种方式git,svn,由于git的分布式的特性，所以我们采用git的方式，现在采用git的平台著名的有两个<a href="(http://www.gitlab.org)">gitlab</a>,<a href="(http://www.github.com)">github</a>  </p>
<h4 id="gitlab"><a href="#gitlab" class="headerlink" title="gitlab"></a>gitlab</h4><h4 id="github"><a href="#github" class="headerlink" title="github"></a>github</h4><h3 id="代码测试"><a href="#代码测试" class="headerlink" title="代码测试"></a>代码测试</h3><ul>
<li><p>代码测试框架mocha  </p>
</li>
<li><p>网络持续集成平台  </p>
</li>
</ul>
<h3 id="代码部署"><a href="#代码部署" class="headerlink" title="代码部署"></a>代码部署</h3><p>现在的代码部署，其实是很方便的，我采用的方案，是通过<a href="(http://www.alauda.cn)">灵雀云</a>,代码托管采用的是aliyun的vps服务器  </p>
<h4 id="持续构建镜像"><a href="#持续构建镜像" class="headerlink" title="持续构建镜像"></a>持续构建镜像</h4><p>这里主要概述如何在灵雀云上构建一个持续构建的镜像   </p>
<h4 id="运行你的服务"><a href="#运行你的服务" class="headerlink" title="运行你的服务"></a>运行你的服务</h4><ul>
<li>购买aliyun服务器  </li>
</ul>
<ul>
<li>安装docker环境  </li>
</ul>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-<span class="builtin-name">get</span> install docker.io</span><br></pre></td></tr></table></figure>
<ul>
<li>启动软件服务  </li>
</ul>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo docker run -d index<span class="selector-class">.aluda</span><span class="selector-class">.com</span>/park/myweb</span><br></pre></td></tr></table></figure>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    



      <div class="session-wechat" align="center">
        <img alt="关注微信公众号 haibintalk，最新文章主动推送" style="border-width:0" src="http://tp.linqmind.com/2016-12-07-qrcode_for_gh_ff0c28b2feaf_258.jpg">
      </div>
      <div class="session-wechat-tip" align="center">
          关注微信公众号: haibintalk
      </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://www.haibin.me/2015/11/10/学习nodejs第一课/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="haibin">
      <meta itemprop="description" content="Haibin">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="HaibinTalk">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2015/11/10/学习nodejs第一课/" class="post-title-link" itemprop="url">学习nodejs第一课</a>
              
            
          </h1>
        

        <div class="post-meta">

          
          
          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2015-11-10 07:28:02" itemprop="dateCreated datePublished" datetime="2015-11-10T07:28:02+08:00">2015-11-10</time>
            </span>
          

          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2019-07-04 07:28:43" itemprop="dateModified" datetime="2019-07-04T07:28:43+08:00">2019-07-04</time>
              </span>
            
          

          

          
            
            
          

          
          

          

          <br>
          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="一步一步学习nodejs-startup"><a href="#一步一步学习nodejs-startup" class="headerlink" title="一步一步学习nodejs-startup"></a>一步一步学习nodejs-startup</h1><p>讲解点:  </p>
<ul>
<li>nodejs特点</li>
<li>nodejs与v8</li>
<li>nodejs与libuv</li>
<li>nodejs的应用场景</li>
</ul>
<h2 id="概要"><a href="#概要" class="headerlink" title="概要"></a>概要</h2><p>我们已经有许多web容器，为什么还需要有nodejs呢？</p>
<ul>
<li>IIS  </li>
<li>Apache  </li>
<li>Tomcat  </li>
<li>nginx</li>
<li>…  </li>
</ul>
<p>因为nodejs具有以下特点:</p>
<ul>
<li>异步I/O  </li>
<li>事件与回调  </li>
<li>跨平台  </li>
<li>单线程  </li>
</ul>
<h2 id="nodejs特点"><a href="#nodejs特点" class="headerlink" title="nodejs特点"></a>nodejs特点</h2><ul>
<li>异步I/O  {:&amp;.moveIn}   </li>
</ul>
<p>这个是经典前端的异步I/O  </p>
<p><img src="http://7xlp7m.com1.z0.glb.clouddn.com/前端异步调用.png" alt="&quot;前端异步调用&quot;" title="前端异步调用"></p>
<p><strong>查看代码 N</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$.post(<span class="string">'/url'</span>, &#123;<span class="attr">title</span>: <span class="string">'Parkpang讲Node.js'</span>&#125;, <span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>&#123; </span><br><span class="line">	<span class="built_in">console</span>.log(<span class="string">'收到讲课请求'</span>);&#125;); </span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'发送讲课请求完毕'</span>);</span><br></pre></td></tr></table></figure>
<p>这个是后端的异步操作<br><img src="http://7xlp7m.com1.z0.glb.clouddn.com/服务器端异步调用.png" alt="&quot;后端异步调用&quot;" title="后端异步调用"><br><strong>查看代码 N</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);</span><br><span class="line"><span class="keyword">var</span> path = <span class="regexp">/home/</span>parkpang.png;fs.readFile(<span class="string">'path'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">err, file</span>) </span>&#123; </span><br><span class="line">	<span class="built_in">console</span>.log(<span class="string">'读取parkpang的照片成功'</span>)&#125;); </span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'发起读取parkpang的照片'</span>);</span><br></pre></td></tr></table></figure>
<ul>
<li>事件与回调函数  </li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>);<span class="keyword">var</span> querystring = <span class="built_in">require</span>(<span class="string">'querystring'</span>);<span class="comment">//   服务器的request事件 </span></span><br><span class="line">http.createServer(</span><br><span class="line">	<span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;		<span class="keyword">var</span> postData = <span class="string">''</span>; req.setEncoding(<span class="string">'utf8'</span>);		<span class="comment">//   请求的data事件 </span></span><br><span class="line">		req.on(<span class="string">'data'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">trunk</span>) </span>&#123;			postData += trunk; &#125;);<span class="comment">//   请求的end事件 </span></span><br><span class="line">		req.on(<span class="string">'end'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;		res.end(postData); </span><br><span class="line">	&#125;);&#125;).listen(<span class="number">8080</span>); </span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'服务器启动成功'</span>);</span><br></pre></td></tr></table></figure>
<ul>
<li><p>跨平台</p>
</li>
<li><p>单线程 <strong>N</strong>     </p>
</li>
</ul>
<p>单线程的优点:<br>（1） 不用像多线程编程那样处处在意状态的同步问题<br>（2） 没有死锁的存在<br>（3） 没有线程上下文交换所带来的性能上的开销<br>单线程的缺点:<br>（1） 无法利用多核CPU  ？<br>（2） 错误会引起整个应用退出,应用的健壮性值得考验<br>（3） 大量计算占用CPU导致无法继续调用异步I/O   </p>
<h2 id="nodejs历史"><a href="#nodejs历史" class="headerlink" title="nodejs历史"></a>nodejs历史</h2><ul>
<li>2009年3月,Ryan Dahl在其博客上宣布准备基于V8创建一个轻量级的Web服务器并提供一套库  {:&amp;.moveIn}</li>
<li>2009年5月,Ryan Dahl在GitHub上发布了最初的版本  </li>
<li>2009年12月和2010年4月,两届JSConf大会都安排了Node的讲座  </li>
<li>2010年年底,Node获得硅谷云计算服务商Joyent公司的资助,其创始人Ryan Dahl加入Joyent公司全职负责Node的发展  </li>
<li><strong>2011年7月,Node在微软的支持下发布了其Windows版本</strong>  </li>
<li>2011年11月,Node超越Ruby on Rails,成为GitHub上关注度最高的项目(随后被Bootstrap 7 项目超越,目前仍居第二）  </li>
<li>2012年1月底,Ryan Dahl在对Node架构设计满意的情况下,将掌门人的身份转交给Isaac Z. Schlueter,自己转向一些研究项目。Isaac Z. Schlueter是Node的包管理器<a href="https://npmjs.org" target="_blank" rel="noopener">NPM</a>的作者,之 后Node的版本发布和bug修复等工作由他接手  {:&amp;.moveIn}  </li>
<li><strong>2014年12月份左右，iojs从nodejs分裂出来</strong>  </li>
<li><strong>2015年9月份左右，iojs又回归到nodejs</strong>  </li>
</ul>
<h2 id="v8引擎"><a href="#v8引擎" class="headerlink" title="v8引擎"></a>v8引擎</h2><ul>
<li>chrome与v8组件图  </li>
</ul>
<p><img src="http://7xlp7m.com1.z0.glb.clouddn.com/chrome组件图.png" alt="chrome与v8组件图" title="chrome与v8组件图"></p>
<h3 id="nodejs与v8"><a href="#nodejs与v8" class="headerlink" title="nodejs与v8"></a>nodejs与v8</h3><hr>
<ul>
<li>nodejs与v8组件图<br><img src="http://7xlp7m.com1.z0.glb.clouddn.com/node组件图.png" alt="nodejs与v8组件图" title="chrome与v8组件图"></li>
</ul>
<h3 id="什么是v8引擎"><a href="#什么是v8引擎" class="headerlink" title="什么是v8引擎?"></a>什么是v8引擎?</h3><p><a href="https://zh.wikipedia.org/wiki/V8_(JavaScript引擎)" target="_blank" rel="noopener">V8</a>是一个由美国Google开发的开源JavaScript引擎，用于Google Chrome中。<br>V8在运行之前将JavaScript编译成了机器码，而非字节码或是解释执行它，以此提升性能。更进一步，使用了如内联缓存（inline caching）等方法来提高性能。有了这些功能，JavaScript程序与V8引擎的速度媲美二进制编译。  </p>
<h2 id="nodejs如何实现跨平台"><a href="#nodejs如何实现跨平台" class="headerlink" title="nodejs如何实现跨平台"></a>nodejs如何实现跨平台</h2><ul>
<li>nodejs最初的跨平台方案   </li>
</ul>
<p><img src="http://7xlp7m.com1.z0.glb.clouddn.com/node跨平台_origin.png" alt="nodejs最初的跨平台方案" title="nodejs最初的跨平台方案"></p>
<ul>
<li>nodejs是通过libuv实现跨平台  </li>
</ul>
<p><img src="http://7xlp7m.com1.z0.glb.clouddn.com/nodejs跨平台_v0.6.0.png" alt="nodejs是通过libuv实现跨平台" title="nodejs是通过libuv实现跨平台">  </p>
<blockquote>
<p>libuv 是 Node 的新跨平台抽象层，用于抽象 Windows 的 IOCP 及 *nix 的 libev。作者打算在这个库的包含所有平台的差异性。</p>
</blockquote>
<p><img src="http://7xlp7m.com1.z0.glb.clouddn.com/libuv.png" alt="libuv与系统" title="libuv与系统"></p>
<p><a href="http://blog.codingnow.com/2012/01/libuv.html" target="_blank" rel="noopener">http://blog.codingnow.com/2012/01/libuv.html</a><br><a href="http://baike.baidu.com/view/1256215.htm" target="_blank" rel="noopener">http://baike.baidu.com/view/1256215.htm</a></p>
<p><img src="http://7xlp7m.com1.z0.glb.clouddn.com/IOCP模型.png" alt="IOCP" title="IOCP"></p>
<p><strong>IOCP定义 N</strong></p>
<blockquote>
<p>IOCP（I/O Completion Port）,常称I/O完成端口。 IOCP模型属于一种通讯模型，适用于(能控制并发执行的)高负载服务器的一个技术。 通俗一点说，就是用于高效处理很多很多的客户端进行数据交换的一个模型。或者可以说，就是能异步I/O操作的模型。  </p>
</blockquote>
<h2 id="nodejs如何突破单线程"><a href="#nodejs如何突破单线程" class="headerlink" title="nodejs如何突破单线程"></a>nodejs如何突破单线程</h2><ul>
<li>HTML5如何解决前端javascript大计算阻塞UI渲染的问题？<br>html5是采用<strong>Web Workers</strong>来解决js大计算阻塞ui的问题<br>demo_workers.js源码  </li>
</ul>
<figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">var <span class="built_in">i</span>=<span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">timedCount</span><span class="params">()</span></span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="built_in">i</span>=<span class="built_in">i</span>+<span class="number">1</span>;</span><br><span class="line">	postMessage(<span class="built_in">i</span>);</span><br><span class="line">	setTimeout(<span class="string">"timedCount()"</span>,<span class="number">500</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">timedCount();</span><br></pre></td></tr></table></figure>
<p>index.html源码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> w;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">startWorker</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(typeof(Worker)!==<span class="string">"undefined"</span>)</span><br><span class="line">	&#123;</span><br><span class="line">	  <span class="keyword">if</span>(typeof(w)==<span class="string">"undefined"</span>)</span><br><span class="line">	    &#123;</span><br><span class="line">	    w=<span class="keyword">new</span> Worker(<span class="string">"demo_workers.js"</span>);</span><br><span class="line">	    &#125;</span><br><span class="line">	  w.onmessage = <span class="function"><span class="keyword">function</span> <span class="params">(event)</span> </span>&#123;</span><br><span class="line">	    document.getElementById(<span class="string">"result"</span>).innerHTML=event.data;</span><br><span class="line">	  &#125;;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">	&#123;</span><br><span class="line">		document.getElementById(<span class="string">"result"</span>).innerHTML=<span class="string">"Sorry, your browser</span></span><br><span class="line"><span class="string">		 does not support Web Workers..."</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">stopWorker</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	w.terminate();</span><br><span class="line">&#125;</span><br><span class="line">```  </span><br><span class="line"></span><br><span class="line">* nodejs是如何解决javascript大计算阻塞的呢？</span><br><span class="line">node采用了与Web Workers相同的思路来解决单线程中大计算量的问题，使用Nodejs的一个十分重要的模块child_process，通过它可以创建多进程，以利用多核计算资源。</span><br><span class="line"></span><br><span class="line"><span class="comment">## child_process介绍  </span></span><br><span class="line">child_process创建子进程的四个函数  </span><br><span class="line"></span><br><span class="line">spawn,exec,execFile,fork</span><br><span class="line"></span><br><span class="line">![](http:<span class="comment">//7xlp7m.com1.z0.glb.clouddn.com/子进程.png "")</span></span><br><span class="line"></span><br><span class="line">* spawn</span><br></pre></td></tr></table></figure>
<p>child_process = require (‘child_process’);<br>options ={stdio: [‘ipc’] };<br>child = child_process.spawn(‘coffee’, [‘./child.coffee’], options);   </p>
<p>注解:  </p>
<p>IPC（Inter-Process Communication，进程间通信）<br><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">* exec  </span><br><span class="line"></span><br><span class="line">```<span class="built_in">require</span>(<span class="string">'child_process'</span>).exec( <span class="string">'ls -lh /home'</span> , <span class="function"><span class="keyword">function</span><span class="params">(err, stdout , stderr )</span></span> &#123;</span><br><span class="line">   console.<span class="built_in">log</span>( <span class="built_in">stdout</span> );</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<ul>
<li>execFile <strong>N</strong></li>
</ul>
<figure class="highlight plain"><figcaption><span>childProcess </span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">var path = &quot;/home&quot;;</span><br><span class="line">childProcess.execFile(&apos;/bin/ls&apos;, [&apos;-l&apos;, path], function (err, result) &#123;</span><br><span class="line">    console.log(result)</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<ul>
<li>fork</li>
</ul>
<p>```var n = require(‘child_process’).fork( ‘./child.js’);<br>n.on ( ‘message’, function(m) {<br>  console. log ( ‘ParkPang got message:’, m);<br>});<br>n.send({ ToChildProcess: ‘讨论需求’ });</p>
<p>child.js:</p>
<p>process.on ( ‘message’, function(m) {<br>   console.log ( ‘Homer got message:’, m);<br>});<br>process.send({ ToParentProcess: ‘正在进行需求讨论’ });<br>```   </p>
<h2 id="nodejs的应用场景"><a href="#nodejs的应用场景" class="headerlink" title="nodejs的应用场景"></a>nodejs的应用场景</h2><ul>
<li>I/O密集型  </li>
<li>兼容已有系统  </li>
<li>分布式应用  </li>
<li>计算密集???  </li>
</ul>
<h2 id="FAQ？"><a href="#FAQ？" class="headerlink" title="FAQ？"></a>FAQ？</h2><ul>
<li>nodejs是通过什么跨平台的？</li>
<li>nodejs有哪些特点?</li>
</ul>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    



      <div class="session-wechat" align="center">
        <img alt="关注微信公众号 haibintalk，最新文章主动推送" style="border-width:0" src="http://tp.linqmind.com/2016-12-07-qrcode_for_gh_ff0c28b2feaf_258.jpg">
      </div>
      <div class="session-wechat-tip" align="center">
          关注微信公众号: haibintalk
      </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://www.haibin.me/2015/10/13/互联网女皇2015年报告/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="haibin">
      <meta itemprop="description" content="Haibin">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="HaibinTalk">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2015/10/13/互联网女皇2015年报告/" class="post-title-link" itemprop="url">互联网女皇2015年互联网报告</a>
              
            
          </h1>
        

        <div class="post-meta">

          
          
          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2015-10-13 00:10:10" itemprop="dateCreated datePublished" datetime="2015-10-13T00:10:10+08:00">2015-10-13</time>
            </span>
          

          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2019-07-04 07:28:43" itemprop="dateModified" datetime="2019-07-04T07:28:43+08:00">2019-07-04</time>
              </span>
            
          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/互联网报告/" itemprop="url" rel="index"><span itemprop="name">互联网报告</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          <br>
          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>2015 年互联网女皇<a href="http://en.wikipedia.org/wiki/Mary_Meeker" target="_blank" rel="noopener">Mary_Meeker</a>出报告了，<br>报告下载地址:<br><a href="http://7bv984.com1.z0.glb.clouddn.com/“互联网女皇报告”中文版_腾讯科技.pdf" target="_blank" rel="noopener">2015 互联网报告下载</a>  </p>
<blockquote>
<p><a href="http://www.haibin.me/2014/05/29/2014-05-29-internet-2014-report/">2015以前报告传送门</a></p>
</blockquote>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    



      <div class="session-wechat" align="center">
        <img alt="关注微信公众号 haibintalk，最新文章主动推送" style="border-width:0" src="http://tp.linqmind.com/2016-12-07-qrcode_for_gh_ff0c28b2feaf_258.jpg">
      </div>
      <div class="session-wechat-tip" align="center">
          关注微信公众号: haibintalk
      </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://www.haibin.me/2015/09/18/晨写于20150918/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="haibin">
      <meta itemprop="description" content="Haibin">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="HaibinTalk">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2015/09/18/晨写于20150918/" class="post-title-link" itemprop="url">[晨写于20150918]</a>
              
            
          </h1>
        

        <div class="post-meta">

          
          
          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2015-09-18 07:33:07" itemprop="dateCreated datePublished" datetime="2015-09-18T07:33:07+08:00">2015-09-18</time>
            </span>
          

          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2019-07-04 07:28:43" itemprop="dateModified" datetime="2019-07-04T07:28:43+08:00">2019-07-04</time>
              </span>
            
          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/人生/" itemprop="url" rel="index"><span itemprop="name">人生</span></a></span>

                
                
                  , 
                
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/人生/感悟/" itemprop="url" rel="index"><span itemprop="name">感悟</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          <br>
          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><img src="http://7xlp7m.com1.z0.glb.clouddn.com/udisk.jpg" alt="U 盘"><br>在大的社会化协作中，我们应该勇敢做u盘人生，把自己这个智能操作系统，经过裁剪与修正，装进一个小的盒子，并通过类似的’USB’口共享出来，U盘人生的特点:  </p>
<ul>
<li><p>接入方便<br>标准化自己，能够很方便的接入公司或者TEAM工作小组</p>
</li>
<li><p>即插即用<br>内置高效的检索系统，与丰富的知识库，能够很方便的进入与退出项目和系统</p>
</li>
<li><p>快速协作<br>统一的工具，统一的语言，团队协作技巧，互补的知识与技能</p>
</li>
<li><p>方便携带<br>走到哪里，带到哪里，用到哪里。</p>
</li>
<li><p>按需付费<br>为自己的工作进行价值估算</p>
</li>
</ul>
<p>当然还有病毒防御功能，能够过滤到不好的，吸收好的东西。我的朋友准备好了吗？让我们一起2B，一起做个小小的U盘!</p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    



      <div class="session-wechat" align="center">
        <img alt="关注微信公众号 haibintalk，最新文章主动推送" style="border-width:0" src="http://tp.linqmind.com/2016-12-07-qrcode_for_gh_ff0c28b2feaf_258.jpg">
      </div>
      <div class="session-wechat-tip" align="center">
          关注微信公众号: haibintalk
      </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://www.haibin.me/2015/09/17/晨写于20150917/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="haibin">
      <meta itemprop="description" content="Haibin">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="HaibinTalk">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2015/09/17/晨写于20150917/" class="post-title-link" itemprop="url">[晨写于20150917]</a>
              
            
          </h1>
        

        <div class="post-meta">

          
          
          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2015-09-17 07:22:32" itemprop="dateCreated datePublished" datetime="2015-09-17T07:22:32+08:00">2015-09-17</time>
            </span>
          

          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2019-07-04 07:28:43" itemprop="dateModified" datetime="2019-07-04T07:28:43+08:00">2019-07-04</time>
              </span>
            
          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/阅读/" itemprop="url" rel="index"><span itemprop="name">阅读</span></a></span>

                
                
                  , 
                
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/阅读/life/" itemprop="url" rel="index"><span itemprop="name">生活</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          <br>
          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><img src="http://img12.360buyimg.com/n0/jfs/t1417/333/1184132989/129633/2ec4b74e/55c07133Nb42cb74a.jpg" alt="增长黑客"><br>最近正在阅读大神<a href="http://www.fanbing.net" target="_blank" rel="noopener">范冰</a>的力作，<a href="http://www.duokan.com/book/97382" target="_blank" rel="noopener">增长黑客</a>,这本书由多位大神联合作序，看起来牛逼闪闪的样子，不过按照我们的话说，并无卵，你对该书感兴趣，可以直接忽略序的部分，直接跳至目录，寻找你感兴趣的章节进行阅读。<br>我也是刚开始阅读这本书，不过从目录看，虽然都是讲解的现在比较成功的创业公司，在公司初期的时候。  </p>
<ul>
<li>如何创造的产品</li>
<li>如何增长用户  </li>
<li>如何获取收入</li>
<li>如何有效传播产品   </li>
</ul>
<p>对于走在创业路上的初创型公司，有比较大的帮助的。后面我会与大家分享其中的观点。  </p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    



      <div class="session-wechat" align="center">
        <img alt="关注微信公众号 haibintalk，最新文章主动推送" style="border-width:0" src="http://tp.linqmind.com/2016-12-07-qrcode_for_gh_ff0c28b2feaf_258.jpg">
      </div>
      <div class="session-wechat-tip" align="center">
          关注微信公众号: haibintalk
      </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://www.haibin.me/2015/09/16/晨写于20150916-1/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="haibin">
      <meta itemprop="description" content="Haibin">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="HaibinTalk">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2015/09/16/晨写于20150916-1/" class="post-title-link" itemprop="url">[晨写于20150916]</a>
              
            
          </h1>
        

        <div class="post-meta">

          
          
          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2015-09-16 07:49:59" itemprop="dateCreated datePublished" datetime="2015-09-16T07:49:59+08:00">2015-09-16</time>
            </span>
          

          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2019-07-04 07:28:43" itemprop="dateModified" datetime="2019-07-04T07:28:43+08:00">2019-07-04</time>
              </span>
            
          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/life/" itemprop="url" rel="index"><span itemprop="name">生活</span></a></span>

                
                
                  , 
                
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/life/感悟/" itemprop="url" rel="index"><span itemprop="name">感悟</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          <br>
          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><img src="https://s-media-cache-ak0.pinimg.com/474x/49/13/89/491389feb719839fa38612999a5559df.jpg" alt="加班">  </p>
<p>为什么加班的总是我？<br>我总结了一下，主要有以下几个方面:  </p>
<ul>
<li><p>讨论的问题的时间过长了<br>这会花掉我三分之一的事情来应对各种各样的讨论，没有目的，来的也很突然。如果我能够有效的解决这个问题，那么我的可支配的时间就会多一些  </p>
</li>
<li><p>阅读电子邮件<br>这个还不是很严重，只是没有专门花时间统一处理。</p>
</li>
<li><p>做一些不必要的事情<br>这个也会花掉我比较多的时间， 有一些事情其实可以找人帮助，或者不做也行  </p>
</li>
</ul>
<p>希望今天对上面的问题做些改进，使自己的时间更合理，做的重要的事情更多，最终消灭[加班]。</p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    



      <div class="session-wechat" align="center">
        <img alt="关注微信公众号 haibintalk，最新文章主动推送" style="border-width:0" src="http://tp.linqmind.com/2016-12-07-qrcode_for_gh_ff0c28b2feaf_258.jpg">
      </div>
      <div class="session-wechat-tip" align="center">
          关注微信公众号: haibintalk
      </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/"><i class="fa fa-angle-left" aria-label="Previous page"></i></a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><a class="page-number" href="/page/4/">4</a><a class="extend next" rel="next" href="/page/3/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>



          </div>
          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <div class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">haibin</p>
              <div class="site-description motion-element" itemprop="description">Haibin</div>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">40</span>
                    <span class="site-state-item-name">posts</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  
                    
                      <a href="/categories/">
                    
                  
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">37</span>
                    <span class="site-state-item-name">categories</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  
                    
                      <a href="/tags/">
                    
                  
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">32</span>
                    <span class="site-state-item-name">tags</span>
                  </a>
                </div>
              
            </nav>
          

          
            <div class="feed-link motion-element">
              <a href="/atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          

          
            <div class="links-of-author motion-element">
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="https://github.com/haibinpark" title="GitHub &rarr; https://github.com/haibinpark" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a>
                </span>
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="/13688065326@qq.com" title="E-Mail &rarr; 13688065326@qq.com"><i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                </span>
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="https://weibo.com/zhaohaibin007" title="Weibo &rarr; https://weibo.com/zhaohaibin007" rel="noopener" target="_blank"><i class="fa fa-fw fa-weibo"></i>Weibo</a>
                </span>
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="http://www.douban.com/people/35912713" title="Douban &rarr; http://www.douban.com/people/35912713" rel="noopener" target="_blank"><i class="fa fa-fw fa-globe"></i>Douban</a>
                </span>
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="http://www.zhihu.com/people/haibinpark" title="Zhihu &rarr; http://www.zhihu.com/people/haibinpark" rel="noopener" target="_blank"><i class="fa fa-fw fa-globe"></i>Zhihu</a>
                </span>
              
            </div>
          

          
             <div class="cc-license motion-element" itemprop="license">
              
              
                
              
              
              
              <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" class="cc-opacity" rel="noopener" target="_blank"><img src="/images/cc-by-nc-sa.svg" alt="Creative Commons"></a>
             </div>
          

          
          

          
            
          
          

        </div>
      </div>

      

      

    </div>
  </aside>
  


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">haibin</span>

  

  
</div>


  <div class="powered-by">Powered by <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> v3.9.0</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme – <a href="https://theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> v7.2.0</div>




        








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

    

    
  </div>

  

<script>
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>


























  
  <script src="/lib/jquery/index.js?v=3.4.1"></script>

  
  <script src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>


  


  <script src="/js/utils.js?v=7.2.0"></script>

  <script src="/js/motion.js?v=7.2.0"></script>



  
  


  <script src="/js/schemes/muse.js?v=7.2.0"></script>



  

  


  <script src="/js/next-boot.js?v=7.2.0"></script>


  

  

  

  



  




  

  

  

  

  

  

  

  

  

  

  

  

  

  

</body>
</html>
